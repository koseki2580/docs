<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Network/tunneling" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">トンネリング | 備忘録</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://koseki2580.github.io/study-docs/docs/Network/tunneling"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="トンネリング | 備忘録"><meta data-rh="true" name="description" content="トンネリング"><meta data-rh="true" property="og:description" content="トンネリング"><link data-rh="true" rel="canonical" href="https://koseki2580.github.io/study-docs/docs/Network/tunneling"><link data-rh="true" rel="alternate" href="https://koseki2580.github.io/study-docs/docs/Network/tunneling" hreflang="ja"><link data-rh="true" rel="alternate" href="https://koseki2580.github.io/study-docs/docs/Network/tunneling" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3TKZBSXW6M-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6FT13EFQVW"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6FT13EFQVW",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="備忘録" href="/study-docs/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="stylesheet" href="/study-docs/assets/css/styles.08669529.css">
<link rel="preload" href="/study-docs/assets/js/runtime~main.d23398ad.js" as="script">
<link rel="preload" href="/study-docs/assets/js/main.eb6b068a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/study-docs/"><b class="navbar__title text--truncate">勉強メモ</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">アルゴリズム</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/binary-search">2分探索</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/breadth-first-search">幅優先探索</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/depth-first-search">深さ優先探索</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/recursive">再帰処理</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/coordinate-compression">座標圧縮</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/doubling">ダブリング</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/dijkstra">ダイクストラ法</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/warshall-floyd">ワーシャル-フロイド法</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/rolling-hash">Rolling Hash</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/square-division">平方分割</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">暗号化アルゴリズム</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/study-docs/docs/Cryptography/classical-cipher/">古典暗号</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">データ構造</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/queue">キュー</a></li><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/stack">スタック</a></li><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/graph">グラフ</a></li><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/tree">木構造</a></li><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/priority-queue">優先度付きキュー</a></li><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/unionfind">Union-Find木</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">データベース</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/study-docs/docs/Database/data-model/">データモデル</a></li><li><a class="dropdown__link" href="/study-docs/docs/Database/relational-data-model">関係モデル</a></li><li><a class="dropdown__link" href="/study-docs/docs/Database/normalization">正規化</a></li><li><a class="dropdown__link" href="/study-docs/docs/Database/transaction">トランザクション</a></li><li><a class="dropdown__link" href="/study-docs/docs/Database/database-specialist/">データベーススペシャリスト</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ネットワーク</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Network/sip">SIP</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Network/voip-network">VoIP</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Network/sdp">SDP</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Network/ip-packet">IP パケット</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Network/tunneling">トンネリング</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Network/diffie-hellman">Diffie-Hellman鍵交換方式</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Network/bgp4">BGP-4</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Network/ospf">OSPF</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Network/was">WAN高速化装置</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Network/other">とりあえずまとめ</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">その他</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/study-docs/docs/other/certification">認証と認可</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/koseki2580/study-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="検索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">検索</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Network/sip">SIP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Network/voip-network">VoIP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Network/sdp">SDP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Network/ip-packet">IP パケット</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/study-docs/docs/Network/tunneling">トンネリング</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Network/diffie-hellman">Diffie-Hellman鍵交換方式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Network/bgp4">BGP-4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Network/ospf">OSPF</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Network/was">WAN高速化装置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Network/other">とりあえずまとめ</a></li></ul></nav><button type="button" title="サイドバーを隠す" aria-label="サイドバーを隠す" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/study-docs/">ホーム</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">トンネリング</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>トンネリング</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="トンネリング">トンネリング<a href="#トンネリング" class="hash-link" aria-label="トンネリング への直接リンク" title="トンネリング への直接リンク">​</a></h2><p>トンネリングとは共用ネットワークの 2 点間で仮想の専用線を構築する技術のことをいう。
トンネリングはトンネリング用のプロトコルを用いてパケットをカプセル化させることで実現させている。</p><p>トンネリングプロトコルにはいくつか種類が存在する。(<a href="https://en.wikipedia.org/wiki/Tunneling_protocol" target="_blank" rel="noopener noreferrer">Wikipedia</a>より)</p><ul><li><a href="https://www.rfc-editor.org/rfc/rfc1853.html" target="_blank" rel="noopener noreferrer">IP in IP</a></li><li><a href="https://datatracker.ietf.org/doc/html/draft-gilligan-ipv6-sit-overview-01" target="_blank" rel="noopener noreferrer">SIT/IPv6</a></li><li><a href="https://www.rfc-editor.org/rfc/rfc2784.html" target="_blank" rel="noopener noreferrer">GRE</a> (<a href="https://www.rfc-editor.org/rfc/rfc1701" target="_blank" rel="noopener noreferrer">RFC1701</a>)</li><li><a href="https://openvpn.net/community-resources/openvpn-cryptographic-layer/" target="_blank" rel="noopener noreferrer">OpenVPN</a> (参考 <a href="https://www.rfc-editor.org/rfc/rfc8922.html#name-openvpn" target="_blank" rel="noopener noreferrer">RFC8922 3.4.3</a>)</li><li><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sstp/c50ed240-56f3-4309-8e0c-1644898f0ea8" target="_blank" rel="noopener noreferrer">SSTP</a> (Secure Socket Tunneling Protocol)</li><li><a href="https://www.rfc-editor.org/rfc/rfc4301.html" target="_blank" rel="noopener noreferrer">IPSec</a> (Internet Protocol Security)</li><li><a href="https://www.rfc-editor.org/rfc/rfc7348.html" target="_blank" rel="noopener noreferrer">VXLAN</a> (Virtual Extensible Local Area Network)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ip-in-ip">IP in IP<a href="#ip-in-ip" class="hash-link" aria-label="IP in IP への直接リンク" title="IP in IP への直接リンク">​</a></h3><p>IP in IP のカプセル化の方法は単純であり、IP パケットに別の IP パケットでカプセル化を行う。</p><p><img loading="lazy" alt="IP in IP" src="data:image/svg+xml;base64,PHN2ZyBob3N0PSI2NWJkNzExNDRlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NDFweCIgaGVpZ2h0PSIxNjJweCIgdmlld0JveD0iLTAuNSAtMC41IDQ0MSAxNjIiIGNvbnRlbnQ9IiZsdDtteGZpbGUmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7NkFFZ1pRQ2JyRUFPakJLRlIxTmkmcXVvdDsgbmFtZT0mcXVvdDvjg5rjg7zjgrgxJnF1b3Q7Jmd0OzdaZE5qOU13RUlaL1RhNG9zZlBoSHJ0dFdUZ2dyYlJJbkYxN2tsaTRkZVc0WC94Nm5HYlNKQ1FMaTBUTFNuQ3B4dTk0eHBsbjNHa2EwTVhtOUdqNXJ2eGtKT2lBaFBJVTBHVkFTQlluL3JNV3pvMUFHV3VFd2lyWlNGRW5QS3R2Z0dLSTZsNUpxQVliblRIYXFkMVFGR2E3QmVFR0dyZldISWZiY3FPSHArNTRBU1BoV1hBOVZyOG82Y3BHWlNUcjlBK2dpckk5T1VwbmpXZkQyODFZU1ZWeWFZNDlpYTRDdXJER3VNYmFuQmFnYTNZdGx5YnUvUXZlNjROWjJMclhCSkFtNE1EMUhtdjcrQlNRVlB2Z2g3WDFWbEZid1lvR2pBYXorY1Vnd1R4R1piNUU0MkdCQnNOS0szZHVhVm16MzBxb0R3eDlybU9wSER6dnVLaTlSMzg5dkZhNmpmYXJ5SnU1MG5waHRMR1hXSm96QVVKNHZYTFdmSVdlWjgyU09La1Rqa3RHQ2dld0RrNDlDUkU4Z3RtQXMyZS9CYjBreEhiZ2ZZeFNYQis3N2w2MXN0ZlpHRFdPRjZxNHB1Nllld094VDdlQS9sWUxXTXVadGtiWXRlQ1BrczhoblNZdnM5azZ2QlY1Y2tmeThZajhpS0QvZnU1cU05ZHdtdGVUdzVjTlc0bm1VbWhlVlVvTVFYcC9PeFg4RVpjMWpyRDBIYVYxSTlBYmtUSDJOT1N6S0p2Q1RwWlorblBzSUFkamF3eTlCeldaWU5wcUZqUjM2akFjZGxPZzhZUW5vL3lUWEhzYXY5VFROa1ZsOWxZQVJ2V0gwNCtKNGw4a2N0d1c0RWFKTG4yL2x2MnFxNUQ4bjRNMWNQWVg1MkQ2TDgvQkVmbDd6c0ZzUlA3ejNyODQ2VGRBWHliQVpEeEZuNUUxVGRQYjBHZDNoTS9lNXJXWEhGZytlZTFUd1dDZDN3WjhmRHZ3ZnRtOVZqZS9FTjEvRTdyNkRnPT0mbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7Ij4KICAgIDxkZWZzLz4KICAgIDxnPgogICAgICAgIDxyZWN0IHg9IjAiIHk9IjEyMCIgd2lkdGg9IjE2MCIgaGVpZ2h0PSI0MCIgZmlsbD0iI2Y4Y2VjYyIgc3Ryb2tlPSIjYjg1NDUwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDE1OHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDE0MHB4OyBtYXJnaW4tbGVmdDogMXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTJweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSVAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOODmuOCpOODreODvOODiQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iODAiIHk9IjE0NCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIElQLi4uCiAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgIDwvc3dpdGNoPgogICAgICAgIDwvZz4KICAgICAgICA8cmVjdCB4PSIwIiB5PSI4MCIgd2lkdGg9IjE2MCIgaGVpZ2h0PSI0MCIgZmlsbD0iI2ZmZTZjYyIgc3Ryb2tlPSIjZDc5YjAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDE1OHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDEwMHB4OyBtYXJnaW4tbGVmdDogMXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTJweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSVAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOODmOODg+ODgOODvAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iODAiIHk9IjEwNCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIElQLi4uCiAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgIDwvc3dpdGNoPgogICAgICAgIDwvZz4KICAgICAgICA8cGF0aCBkPSJNIDIwMC41IDg2IEwgMjAwLjUgNzQgTCAyMTkuNTEgNzQgTCAyMTkuNTEgNjEuNSBMIDIzOS41IDgwIEwgMjE5LjUxIDk4LjUgTCAyMTkuNTEgODYgWiIgZmlsbD0iIzYwYTkxNyIgc3Ryb2tlPSIjMmQ3NjAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8cmVjdCB4PSIyODAiIHk9IjEyMCIgd2lkdGg9IjE2MCIgaGVpZ2h0PSI0MCIgZmlsbD0iI2Y4Y2VjYyIgc3Ryb2tlPSIjYjg1NDUwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDE1OHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDE0MHB4OyBtYXJnaW4tbGVmdDogMjgxcHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICIgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMnB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJUAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxici8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg44Oa44Kk44Ot44O844OJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2ZvcmVpZ25PYmplY3Q+CiAgICAgICAgICAgICAgICA8dGV4dCB4PSIzNjAiIHk9IjE0NCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIElQLi4uCiAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgIDwvc3dpdGNoPgogICAgICAgIDwvZz4KICAgICAgICA8cmVjdCB4PSIyODAiIHk9IjgwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjZmZlNmNjIiBzdHJva2U9IiNkNzliMDAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTAwcHg7IG1hcmdpbi1sZWZ0OiAyODFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElQCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDjg5jjg4Pjg4Djg7wKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICAgIDx0ZXh0IHg9IjM2MCIgeT0iMTA0IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+CiAgICAgICAgICAgICAgICAgICAgSVAuLi4KICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxyZWN0IHg9IjI4MCIgeT0iNDAiIHdpZHRoPSIxNjAiIGhlaWdodD0iNDAiIGZpbGw9IiNkNWU4ZDQiIHN0cm9rZT0iIzgyYjM2NiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxNThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiA2MHB4OyBtYXJnaW4tbGVmdDogMjgxcHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICIgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMnB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUdW5uZWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOODmOODg+ODgOODvAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iMzYwIiB5PSI2NCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIFR1bm5lbC4uLgogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHJlY3QgeD0iMjgwIiB5PSIwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjZGFlOGZjIiBzdHJva2U9IiM2YzhlYmYiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMjBweDsgbWFyZ2luLWxlZnQ6IDI4MXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTJweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSVAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOODmOODg+ODgOODvAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iMzYwIiB5PSIyNCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIElQLi4uCiAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgIDwvc3dpdGNoPgogICAgICAgIDwvZz4KICAgIDwvZz4KICAgIDxzd2l0Y2g+CiAgICAgICAgPGcgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ii8+CiAgICAgICAgPGEgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtNSkiIHhsaW5rOmhyZWY9Imh0dHBzOi8vd3d3LmRpYWdyYW1zLm5ldC9kb2MvZmFxL3N2Zy1leHBvcnQtdGV4dC1wcm9ibGVtcyIgdGFyZ2V0PSJfYmxhbmsiPgogICAgICAgICAgICA8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjEwcHgiIHg9IjUwJSIgeT0iMTAwJSI+CiAgICAgICAgICAgICAgICBWaWV3ZXIgZG9lcyBub3Qgc3VwcG9ydCBmdWxsIFNWRyAxLjEKICAgICAgICAgICAgPC90ZXh0PgogICAgICAgIDwvYT4KICAgIDwvc3dpdGNoPgo8L3N2Zz4=" title="IP in IP" width="441" height="162" class="img_ev3q"></p><p>(<a href="https://www.rfc-editor.org/rfc/rfc1853.html" target="_blank" rel="noopener noreferrer">RFC1853</a>より)</p><p>外側の IP ヘッダについて以下のようになる。</p><ul><li><p><code>Type Of Service</code></p><p>元の IP ヘッダの内容をコピーする。また、必要に応じて変更されることもある。</p></li><li><p><code>Identification</code></p><p>新しく作成する。</p></li><li><p><code>Don&#x27;t Fragment</code></p><p>元の IP ヘッダの内容をコピーする。</p></li><li><p><code>More Fragments</code></p><p>フラグメンテーションが発生する場合は必要である。</p></li><li><p><code>Time To Live</code></p><p><a href="https://www.rfc-editor.org/rfc/rfc3232.html" target="_blank" rel="noopener noreferrer">RFC3232</a> (<a href="https://www.rfc-editor.org/rfc/rfc1700.html" target="_blank" rel="noopener noreferrer">RFC1700</a>)で決められたデフォルト値を使用</p></li><li><p><code>Protocol</code></p><p>次のヘッダ。トンネルヘッダが存在しない場合であれば、内部 IPv4 となる。</p></li><li><p><code>Source address</code></p><p>データグラムの送信に使用されるインターフェースに関連付けられた IP アドレス。</p></li><li><p><code>Destination address</code></p><p>カプセル化を解除する宛先 IP アドレス</p></li><li><p><code>Options</code></p><p>元の IP ヘッダからコピーしない。新しいものが追加されることがある。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sitipv6">SIT/IPv6<a href="#sitipv6" class="hash-link" aria-label="SIT/IPv6 への直接リンク" title="SIT/IPv6 への直接リンク">​</a></h3><p>IPv6 同士で通信を行う際に途中で IPv4 で通信を行わないといけない場面が生じた際に、IPv4 でやりとりするためにカプセル化を行う。
カプセル化を行うことで IPv4 としてデータをやりとりができるようになる。</p><p><img loading="lazy" alt="SIT/IPv6" src="/study-docs/assets/images/tunneling-2.drawio-25a150ca2cecdb7704b240763a1674e5.svg" title="SIT/IPv6" width="582" height="231" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gre">GRE<a href="#gre" class="hash-link" aria-label="GRE への直接リンク" title="GRE への直接リンク">​</a></h3><p>GRE は Generic Routing Encapsulation の略であり、以下のような形式をとる。</p><p><img loading="lazy" alt="GRE" src="data:image/svg+xml;base64,PHN2ZyBob3N0PSI2NWJkNzExNDRlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIxNjFweCIgaGVpZ2h0PSIxMjFweCIgdmlld0JveD0iLTAuNSAtMC41IDE2MSAxMjEiIGNvbnRlbnQ9IiZsdDtteGZpbGUmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7NkFFZ1pRQ2JyRUFPakJLRlIxTmkmcXVvdDsgbmFtZT0mcXVvdDvjg5rjg7zjgrgxJnF1b3Q7Jmd0O3ZaUTdiNE13RUlCL0RUdXZFTEtXcE1sU3FXcUd6bzU5Qml1R2l4d25RSDk5VFRBdlFhVU9UUmRrZjNkbit6NWJPRUdTVjN0Rkx0a2JNcENPNzdMS0NiYU83OGUrYTc0TnFGc1ErdXNXcEVxd0Zua0RPSW92c05EV3BUZkI0RHBKMUloU2k4c1VVaXdLb0hyQ2lGSllUdE00eXVtdUY1TENEQndwa1hQNktaak91cmJXQXorQVNMTnVaeS9hdEpHY2RNbTJrMnRHR0pZakZPeWNJRkdJdWgzbFZRS3ljZGQ1YWV0ZWY0ajJCMU5RNk44VStHM0JuY2liN2UyZDFCSUplNnhDejZEdE9YWGROYS93VmpCbzZsMG5lQ2t6b2VGb1VwdG9hVzdic0V6bjBzdzhNK1JDeWdRbHFrZHR3R01LbEJwKzFRclBNSXFjNGxXNGFoYWNkMkNidW9QU1VJMlE3V2dQbUlOV3RVbXgwVEMwZHUzejhpSTdMNGZMNmxrMnVxaXVqdGoza2ZaTER3ck53RnBjTmhyUGpPNC9kZ1ljZ0RCUWYycVRFWWo1b3MySXhuRGl2YzJadWdYQnY3ZnAvNlBOemN6bUZxUXcvZFRQVWNvNVJNc1BsSzAzSjlkOWp0TDRlVWJOZFBpYlBHS2pYM0t3K3dZPSZsdDsvZGlhZ3JhbSZndDsmbHQ7L214ZmlsZSZndDsiPgogICAgPGRlZnMvPgogICAgPGc+CiAgICAgICAgPHJlY3QgeD0iMCIgeT0iODAiIHdpZHRoPSIxNjAiIGhlaWdodD0iNDAiIGZpbGw9IiNmOGNlY2MiIHN0cm9rZT0iI2I4NTQ1MCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxNThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAxMDBweDsgbWFyZ2luLWxlZnQ6IDFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBheWxvYWQgcGFja2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2ZvcmVpZ25PYmplY3Q+CiAgICAgICAgICAgICAgICA8dGV4dCB4PSI4MCIgeT0iMTA0IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+CiAgICAgICAgICAgICAgICAgICAgUGF5bG9hZCBwYWNrZXQKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxyZWN0IHg9IjAiIHk9IjQwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjZGFlOGZjIiBzdHJva2U9IiM2YzhlYmYiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogNjBweDsgbWFyZ2luLWxlZnQ6IDFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdSRSBIZWFkZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICAgIDx0ZXh0IHg9IjgwIiB5PSI2NCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIEdSRSBIZWFkZXIKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxNjAiIGhlaWdodD0iNDAiIGZpbGw9IiNmZmU2Y2MiIHN0cm9rZT0iI2Q3OWIwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxNThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAyMHB4OyBtYXJnaW4tbGVmdDogMXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTJweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVsaXZlcnkgSGVhZGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2ZvcmVpZ25PYmplY3Q+CiAgICAgICAgICAgICAgICA8dGV4dCB4PSI4MCIgeT0iMjQiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMnB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgICAgICAgICAgICAgICAgICBEZWxpdmVyeSBIZWFkZXIKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgPC9nPgogICAgPHN3aXRjaD4KICAgICAgICA8ZyByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiLz4KICAgICAgICA8YSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLC01KSIgeGxpbms6aHJlZj0iaHR0cHM6Ly93d3cuZGlhZ3JhbXMubmV0L2RvYy9mYXEvc3ZnLWV4cG9ydC10ZXh0LXByb2JsZW1zIiB0YXJnZXQ9Il9ibGFuayI+CiAgICAgICAgICAgIDx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtc2l6ZT0iMTBweCIgeD0iNTAlIiB5PSIxMDAlIj4KICAgICAgICAgICAgICAgIFZpZXdlciBkb2VzIG5vdCBzdXBwb3J0IGZ1bGwgU1ZHIDEuMQogICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgPC9hPgogICAgPC9zd2l0Y2g+Cjwvc3ZnPg==" title="GRE" width="161" height="121" class="img_ev3q"></p><p>GRE ヘッダは以下の構造をしている(<a href="https://www.rfc-editor.org/rfc/rfc2784.html" target="_blank" rel="noopener noreferrer">RFC2784</a>はまだ(2023 年 1 月現在)Proposed Standard なので<!-- -->[RFC1701][rfc1071]<!-- -->で記述されている構造)。</p><p><img loading="lazy" alt="GRE Header" src="/study-docs/assets/images/tunneling-4.drawio-66a75b996e835e0089eee22208bc7577.svg" title="GRE Header" width="701" height="241" class="img_ev3q"></p><ul><li><p><code>C</code> (1bits)</p><p><code>Checksum Present</code>の略であり、1 となっていれば<code>Checksum</code>が存在することを意味する。</p></li><li><p><code>R</code> (1bits)</p><p><code>Routing Present</code>の略であり、1 となっていれば<code>Offset</code>と<code>Routing</code>が存在することを意味する。</p></li><li><p><code>K</code> (1bits)</p><p><code>Key Present</code>の略であり、1 となっていれば<code>Key</code>が存在することを意味する。</p></li><li><p><code>S</code> (1bits)</p><p><code>Sequence Number Present</code>の略であり、1 となっていれば<code>Sequence Number</code>が存在することを意味する。</p></li><li><p><code>s</code> (1bits)</p><p><code>Strict Source Route</code>の略であり、1 となっていれば<code>Strict Source route</code>であることを意味する。
Strict Source route とは送信者がパケットが通過する経路を指定することを意味している。</p></li><li><p><code>Recur</code> (3bits)</p><p><code>Recursion Control</code>の略であり、再帰制御で許容される追加のカプセル化の数を格納する(<span style="color:red">間違っているかも</span>)。基本的には 0 が入る</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>原文</summary><div><div class="collapsibleContent_i85q">Recursion control contains a three bit unsigned integer which contains the number of additional encapsulations which are permissible. This SHOULD default to zero.</div></div></details></li><li><p><code>Flags</code> (5bits)</p><p>予約されたものであり、現在は全て 0 が入る。</p></li><li><p><code>Ver</code> (3bits)</p><p><code>Version Number</code>の略であり、必ず 0 を入れる必要がある。</p></li><li><p><code>Protocol Type</code> (16bits)</p><p>ペイロードパケットのプロトコルタイプが格納されている。一般的にはイーサネットプロトコルタイプが格納される。
定義されているプロトコルタイプは以下である。</p><table><thead><tr><th align="center">Protocol Family</th><th align="center">PTYPE</th></tr></thead><tbody><tr><td align="center">Reserved</td><td align="center">0000</td></tr><tr><td align="center">SNA</td><td align="center">0004</td></tr><tr><td align="center">OSI network layer</td><td align="center">00FE</td></tr><tr><td align="center">PUP</td><td align="center">0200</td></tr><tr><td align="center">XNS</td><td align="center">0600</td></tr><tr><td align="center">IP</td><td align="center">0800</td></tr><tr><td align="center">Chaos</td><td align="center">0804</td></tr><tr><td align="center">RFC 826 ARP</td><td align="center">0806</td></tr><tr><td align="center">Frame Relay ARP</td><td align="center">0808</td></tr><tr><td align="center">VINES</td><td align="center">0BAD</td></tr><tr><td align="center">VINES Echo</td><td align="center">0BAE</td></tr><tr><td align="center">VINES Loopback</td><td align="center">0BAF</td></tr><tr><td align="center">DECnet (Phase IV)</td><td align="center">6003</td></tr><tr><td align="center">Transparent Ethernet Bridging</td><td align="center">6558</td></tr><tr><td align="center">Raw Frame Relay</td><td align="center">6559</td></tr><tr><td align="center">Apollo Domain</td><td align="center">8019</td></tr><tr><td align="center">Ethertalk (Appletalk)</td><td align="center">809B</td></tr><tr><td align="center">Novell IPX</td><td align="center">8137</td></tr><tr><td align="center">RFC 1144 TCP/IP compression</td><td align="center">876B</td></tr><tr><td align="center">IP Autonomous Systems</td><td align="center">876C</td></tr><tr><td align="center">Secure Data</td><td align="center">876D</td></tr><tr><td align="center">Reserved</td><td align="center">FFFF</td></tr></tbody></table></li><li><p><code>Offset</code> (16bits)</p><p>Routing フィールドの先頭から、検査されるアクティブ Source Route Entry の最初のバイト(8bit)までのバイトオフセットを示す(<span style="color:red">間違っているかも</span>)。</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>原文</summary><div><div class="collapsibleContent_i85q">The offset field indicates the octet offset from the start of the Routing field to the first octet of the active Source Route Entry to be examined. This field is present if the Routing Present or the Checksum Present bit is set to 1, and contains valid information only if the Routing Present bit is set to 1.</div></div></details></li><li><p><code>Checksum</code> (16bits)</p><p>GRE ヘッダとペイロードのチェックサムが入っている(1 の補数)</p></li><li><p><code>Key</code> (32bits)</p><p>カプセル化により挿入されるものであり、受信者が送信元を確認することが可能。</p></li><li><p><code>Sequence Number</code> (32bits)</p><p>カプセル化で挿入され、符号なし 32bit 数値である。パケットの送信順序を確立するために受信者が使用する可能性がある。</p></li><li><p><code>Routing</code> (可変)</p><p>SRE(Source Route Entries)のリストが格納され、それぞれの SRE は次の形式をとる。</p><p><img loading="lazy" alt="Routing Header" src="/study-docs/assets/images/tunneling-5.drawio-9c8bca026114c13a7af19948aac7dad2.svg" title="Routing Header" width="701" height="121" class="img_ev3q"></p><p>Routing は、0x0000 タイプの address family と長さ 0 とする「NULL」SRE で終了する。</p><ul><li><p><code>Address Family</code> (16bits)</p><p><code>Routing Information</code>のシンタックスとセマンティクスを示す。詳細については別ドキュメントに記載されいる(別ドキュメントのリンクは RFC に貼られていなかった)。</p></li><li><p><code>SRE Offset</code> (8bits)</p><p><code>Routing Information</code>の先頭から、検査する Source Route Entry のアクティブエントリーの最初のオクテットまでのオクテットオフセットを示す。(<span style="color:red">間違っているかも</span>)</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>原文</summary><div><div class="collapsibleContent_i85q">The SRE Offset field indicates the octet offset from the start of the Routing Information field to the first octet of the active entry in Source Route Entry to be examined.</div></div></details></li><li><p><code>SRE Length</code> (8bits)</p><p>SRE のオクテット数が格納されている。これが 0 であるということは最後の SRE であることを意味する。</p></li><li><p><code>Routing Information</code> (可変)</p><p>パケットのルーティングに使用できるデータが含まれている。</p></li></ul><p>平成 28 年 午後 2 問 2 に GRE に関する問題が登場している。</p><p><img loading="lazy" alt="H28 2-2-4" src="/study-docs/assets/images/H28-2-2-4-47b46dfb86c1c565fcf719987f397c7e.png" title="H28 2-2-4" width="782" height="356" class="img_ev3q"></p><p>この図に送信元 IP・宛先 IP を図示すると以下のようになる。</p><p><img loading="lazy" alt="H28 2-2-4++" src="/study-docs/assets/images/tunneling-6.drawio-89ee34ccbc07ed9d5270d0938e7cb6b4.svg" title="H28 2-2-4++" width="531" height="551" class="img_ev3q"></p><p>PC とサーバが専用線で直接接続されているように見える。</p></li></ul><p>GRE は IP マルチキャストパケットもカプセル化することができるため、IPsec のようにマルチキャストパケットでカプセル化できないプロトコルと合わせて使用されることがある。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="openvpn">OpenVPN<a href="#openvpn" class="hash-link" aria-label="OpenVPN への直接リンク" title="OpenVPN への直接リンク">​</a></h3><p>OpenVPN は、サーバ間に暗号化されたトンネルを作成するためのオープンソースの Virtual Private Network（VPN）ソフトウェアである。
(<a href="https://ja.wikipedia.org/wiki/OpenVPN" target="_blank" rel="noopener noreferrer">Wikipedia</a>より)</p><p>OpenVPN は 2 つのモードを持っている。</p><ul><li>Static Key</li><li>TLS</li></ul><p><code>Static Key</code>では事前共有静的キーを使用し、<code>TLS</code>では認証と鍵交換に SSL/TLS <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>+</mo></mrow><annotation encoding="application/x-tex">+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">+</span></span></span></span></span> 証明書を使用する。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="static-key">Static Key<a href="#static-key" class="hash-link" aria-label="Static Key への直接リンク" title="Static Key への直接リンク">​</a></h4><p>トンネリングが開始する前に事前共有キーが生成され、OpenVPN で接続する PC 同士で共有される。このキーには 4 つの独立したキーが含まれている。</p><ul><li>HMAC 送信</li><li>HMAC 受信</li><li>暗号化</li><li>復号化</li></ul><p><a href="https://www.rfc-editor.org/rfc/rfc2104" target="_blank" rel="noopener noreferrer">HMAC</a> は Hash-based Message Authentication Code の略で、メッセージ認証の暗号化技術の 1 つである。</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>原文</summary><div><div class="collapsibleContent_i85q">In static key mode, a pre-shared key is generated and shared between both OpenVPN peers before the tunnel is started. This static key contains 4 independent keys: HMAC send, HMAC receive, encrypt, and decrypt. By default in static key mode, both hosts will use the same HMAC key and the same encrypt/decrypt key.</div></div></details><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tls">TLS<a href="#tls" class="hash-link" aria-label="TLS への直接リンク" title="TLS への直接リンク">​</a></h4><p>SSL セッションは双方向認証で確立される。つまり、接続する両方で証明書を提示する必要がある。
SSL/TLS 認証に成功すると、暗号化・復号化・HMAC キーのソースマテリアルを OpenSSL&#x27;s RAND_bytes 関数を用いて生成し、
SSL/TLS コネクションを通して共有される。キーが双方向に使用されることはないため、各ピアには個別の送信 HMAC、受信 HMAC、パケット暗号化、およびパケット復号化キーがある。</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>原文</summary><div><div class="collapsibleContent_i85q">In SSL/TLS mode, an SSL session is established with bidirectional authentication (i.e. each side of the connection must present its own certificate). If the SSL/TLS authentication succeeds, encryption/decryption and HMAC key source material is then randomly generated by OpenSSL&#x27;s RAND_bytes function and exchanged over the SSL/TLS connection. Both sides of the connection contribute random source material. This mode never uses any key bidirectionally, so each peer has a distinct send HMAC, receive HMAC, packet encrypt, and packet decrypt key.</div></div></details><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>備考</div><div class="admonitionContent_S0QG"><p>原文は<a href="https://openvpn.net/community-resources/openvpn-cryptographic-layer/" target="_blank" rel="noopener noreferrer">OpenVPN</a>から引用している。</p></div></div><p>OpenVPN は次のような形式をしている。</p><p><img loading="lazy" alt="OpenVPN" src="data:image/svg+xml;base64,PHN2ZyBob3N0PSI2NWJkNzExNDRlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0MDFweCIgaGVpZ2h0PSIyODJweCIgdmlld0JveD0iLTAuNSAtMC41IDQwMSAyODIiIGNvbnRlbnQ9IiZsdDtteGZpbGUmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7TVV0Y1VKOWdVeVhGaUR6VDBiWEEmcXVvdDsgbmFtZT0mcXVvdDvjg5rjg7zjgrgxJnF1b3Q7Jmd0OzNWZkxycHN3RVAwYTd3R0RzWmVFa043TmxTcmRSZHNsanlHZ0VodzV6ZzNwMTllQUhaNnA3aUxKb2xJVXpSeS94dWZZTXdiaDhOQjhFL0d4ZU9jWlZNaXhzZ2JoTFhJYzZsanF2d1d1UGVBNmZnL3NSWm4xa0QwQUgrVWYwS0FldHorWEdad21IU1hubFN5UFV6RGxkUTJwbkdDeEVQd3k3WmJ6YXJycU1kN0RBdmhJNDJxSi9pZ3pXWmh0K1FQK0J1VytNQ3ZiaFBVdGg5aDAxanM1RlhIR0x5TUlSd2lIZ25QWlc0Y21oS3JsenZEU2o5dmRhYjBGSnFDV1h4bkFkQnlmY1hYV20zdDdEMElkbkx5YUhRdCtyak5vQjFrSWJ5NUZLZUhqR0tkdDYwVkpyTEJDSGlybDJjck1lUzIxYURadC9iS3FRbDV4MGMyRnN4aG9uaXI4SkFYL0RhTVdrbEpJY3RXaWd3SWhvYm03TS92R2x6cG53QThneFZWMU1RTU14ZnFNZWNhL0RJclpSR1BGU0MycXNWZ2ZrdjF0Nm9GSFpXZ3E3OUJxTDJoRkVVR01JaHFoeUVlQml6WkJhN0FBVVJkRkdGRWJCUXJ4RUtXSWJidk9JV0s3RGxFRzZmcGd4RmhuT0NqWWFVVDE3NDFnOHpqVjNCWFZQS0NadTZZYWRSSk15SE5VSTlZclZYUFdWUXNROHpzaGRtampENG84ODQ3a05JVjA5WTRrMUhNOTYwbHMwMWV5alpkc3p5bUZPZ3ZhZksyOG10Znc3d01MVFNsLzZyYlcvcVdWYU8xdE0zYXUydW5YZzJ5UjdXY0VxcGo0V2FRd1BpWkxVa2VrZVN1Y0dVeEFGY3Z5Yzdya0dwRjZoZSs4Vk1IY05NTnNxcGx2emJUb1E5V2p4cWwvUGhHWmllL09KcEt4MklOY1ROVHBldHYyMTZSMlh5QzEvZDlKN2N5a0p1eEJVdFA1bVhtZzFONUNhdUltcFRRMUx0TDFxMDJrWGRuYWhBYXhEWUlOd3JvUzZabksyS1hmcDJiZFBIZldzMjVHRXVJOXFNYmR2WGd2eWJwa3BjYjFUNHZBUEMxYzg2TFlUalZTUC9aay9vSGM0ZDluaWZXZ3FqZm4zMy9peTFDNXcyTyt2MDdERnhHTy9nST0mbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7Ij4KICAgIDxkZWZzLz4KICAgIDxnPgogICAgICAgIDxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxNjAiIGhlaWdodD0iODAiIGZpbGw9IiNkYWU4ZmMiIHN0cm9rZT0iIzZjOGViZiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxNThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiA0MHB4OyBtYXJnaW4tbGVmdDogMXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMThweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSE1BQwogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iODAiIHk9IjQ1IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMThweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+CiAgICAgICAgICAgICAgICAgICAgSE1BQwogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHJlY3QgeD0iMCIgeT0iODAiIHdpZHRoPSIxNjAiIGhlaWdodD0iODAiIGZpbGw9IiNkNWU4ZDQiIHN0cm9rZT0iIzgyYjM2NiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxNThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAxMjBweDsgbWFyZ2luLWxlZnQ6IDFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDE0cHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOaYjuekuueahOOBquWIneacn+WMluODmeOCr+ODiOODqwogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iODAiIHk9IjEyNCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE0cHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIOaYjuekuueahOOBquWIneacn+WMluODmeOCr+ODiOODqwogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHJlY3QgeD0iMCIgeT0iMTYwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjZjhjZWNjIiBzdHJva2U9IiNiODU0NTAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMjAwcHg7IG1hcmdpbi1sZWZ0OiAxcHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICIgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxOHB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDmmpflj7fljJYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICAgIDx0ZXh0IHg9IjgwIiB5PSIyMDUiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOHB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgICAgICAgICAgICAgICAgICDmmpflj7fljJYKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxwYXRoIGQ9Ik0gMTYwIDE2MCBMIDI0MCAxMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDAsIDAsIDApIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz4KICAgICAgICA8cGF0aCBkPSJNIDE2MCAyNDAgTCAyNDAgMjgwIiBmaWxsPSJub25lIiBzdHJva2U9InJnYigwLCAwLCAwKSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+CiAgICAgICAgPHJlY3QgeD0iMjQwIiB5PSIxMjAiIHdpZHRoPSIxNjAiIGhlaWdodD0iODAiIGZpbGw9IiNmZmYyY2MiIHN0cm9rZT0iI2Q2YjY1NiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxNThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAxNjBweDsgbWFyZ2luLWxlZnQ6IDI0MXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMThweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNjRiaXTjga7jgrfjg7zjgrHjg7Pjgrnnlarlj7cKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICAgIDx0ZXh0IHg9IjMyMCIgeT0iMTY1IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMThweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+CiAgICAgICAgICAgICAgICAgICAgNjRiaXTjga7jgrfjg7zjgrHjg7Pjgrnnlarlj7cKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxyZWN0IHg9IjI0MCIgeT0iMjAwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjZmZlNmNjIiBzdHJva2U9IiNkNzliMDAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMjQwcHg7IG1hcmdpbi1sZWZ0OiAyNDFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDE4cHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOODmuOCpOODreODvOODiQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iMzIwIiB5PSIyNDUiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOHB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgICAgICAgICAgICAgICAgICDjg5rjgqTjg63jg7zjg4kKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgPC9nPgogICAgPHN3aXRjaD4KICAgICAgICA8ZyByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiLz4KICAgICAgICA8YSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLC01KSIgeGxpbms6aHJlZj0iaHR0cHM6Ly93d3cuZGlhZ3JhbXMubmV0L2RvYy9mYXEvc3ZnLWV4cG9ydC10ZXh0LXByb2JsZW1zIiB0YXJnZXQ9Il9ibGFuayI+CiAgICAgICAgICAgIDx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtc2l6ZT0iMTBweCIgeD0iNTAlIiB5PSIxMDAlIj4KICAgICAgICAgICAgICAgIFZpZXdlciBkb2VzIG5vdCBzdXBwb3J0IGZ1bGwgU1ZHIDEuMQogICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgPC9hPgogICAgPC9zd2l0Y2g+Cjwvc3ZnPg==" title="OpenVPN" width="401" height="282" class="img_ev3q"></p><p>初期化ベクトルとは暗号化の際に使用するランダムに生成されたビット列である。
または、HMAC は初期化ベクトルと暗号化した範囲から算出している。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sstp">SSTP<a href="#sstp" class="hash-link" aria-label="SSTP への直接リンク" title="SSTP への直接リンク">​</a></h3><p>SSTP は Secure Socket Tunneling Protocol の略であり、<a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sstp/c50ed240-56f3-4309-8e0c-1644898f0ea8" target="_blank" rel="noopener noreferrer">Microsoft</a>が開発したプロトコルであり、
HTTPS プロトコルを介して Point-to-Point Protocol (PPP) トラフィックをカプセル化するものである。</p><p>SSTP により、HTTPS を介した PPP トラフィックのカプセル化できるため、次の図のような関係になる(<a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sstp/c50ed240-56f3-4309-8e0c-1644898f0ea8" target="_blank" rel="noopener noreferrer">Microsoft</a>でダウンロードできる PDF の図 1 より)。</p><p><img loading="lazy" alt="SSTP関係図" src="data:image/svg+xml;base64,PHN2ZyBob3N0PSI2NWJkNzExNDRlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIxNjFweCIgaGVpZ2h0PSIzMjFweCIgdmlld0JveD0iLTAuNSAtMC41IDE2MSAzMjEiIGNvbnRlbnQ9IiZsdDtteGZpbGUmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7TVV0Y1VKOWdVeVhGaUR6VDBiWEEmcXVvdDsgbmFtZT0mcXVvdDvjg5rjg7zjgrgxJnF1b3Q7Jmd0O3ZaVkxqNE1nRUlCL2pYY2ZGZWwxM2QzMnNvbUpKbnRHR0I5WkZFTnB0ZnZyRnl0V2pXMnlGM3N4OE0wTU1oOUVMUytzdW9Na1RmRWxHSERMdFZsbmVlK1c2MkxYMXM4ZVhBZXdjNE1CNUxKa0EzSW1FSmUvWUtDcHk4OGxnOU1pVVFuQlZka3NJUlYxRFZRdEdKRlN0TXUwVFBEbFd4dVN3d3JFbFBBMS9TNlpLc2EyZ29rZm9jeUw4YzBPMmcrUmlvekpwcE5UUVpob1o4ajdzTHhRQ3FHR1VkV0Z3SHQzbzVlaDd2Tko5TDR4Q2JYNlQ4SGU3T05DK05rMEYwV1IyWnU2amcxTGNhNFo5RFcyNWIyMVJha2diZ2p0bzYwK1ljMEtWWEU5Yy9Rd0U3VXlaK2JnZmw1eUhnb3U1RzB0anhIQUdkWDhwS1Q0Z1ZrRVVReHBwaVByTGt4akY1QUt1aGt5WFIxQVZLRGtWYWVNMGRHd3VXTCtPRytuQTNPUVljWHNzTEJoeE55Ui9MNzBwRkVQak1rblZwMlYxVGhPTnRicUEyYTdSMXF4bTNvSWJhTVYyYS9VNnE2MEhwTWtpamYxbW1FSzlPRjFUYkcvOCsyTnZPSlhla1VycjBtNDdXM05Na0NQcmJKZ245b2JXUTNRZGxiMWRQcHMzMkt6ZjUvMzhRYz0mbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7Ij4KICAgIDxkZWZzLz4KICAgIDxnPgogICAgICAgIDxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxNjAiIGhlaWdodD0iODAiIGZpbGw9IiNkYWU4ZmMiIHN0cm9rZT0iIzZjOGViZiIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxNThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiA0MHB4OyBtYXJnaW4tbGVmdDogMXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMThweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUFBQCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2ZvcmVpZ25PYmplY3Q+CiAgICAgICAgICAgICAgICA8dGV4dCB4PSI4MCIgeT0iNDUiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxOHB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgICAgICAgICAgICAgICAgICBQUFAKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxyZWN0IHg9IjAiIHk9IjgwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjZDVlOGQ0IiBzdHJva2U9IiM4MmIzNjYiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTIwcHg7IG1hcmdpbi1sZWZ0OiAxcHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICIgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxOHB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTU1RQCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2ZvcmVpZ25PYmplY3Q+CiAgICAgICAgICAgICAgICA8dGV4dCB4PSI4MCIgeT0iMTI1IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMThweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+CiAgICAgICAgICAgICAgICAgICAgU1NUUAogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHJlY3QgeD0iMCIgeT0iMTYwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjZjhjZWNjIiBzdHJva2U9IiNiODU0NTAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMjAwcHg7IG1hcmdpbi1sZWZ0OiAxcHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICIgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxOHB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIVFRQUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iODAiIHk9IjIwNSIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4cHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIEhUVFBTCiAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgIDwvc3dpdGNoPgogICAgICAgIDwvZz4KICAgICAgICA8cmVjdCB4PSIwIiB5PSIyNDAiIHdpZHRoPSIxNjAiIGhlaWdodD0iODAiIGZpbGw9IiNmZmU2Y2MiIHN0cm9rZT0iI2Q3OWIwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxNThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAyODBweDsgbWFyZ2luLWxlZnQ6IDFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDE4cHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRDUAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iODAiIHk9IjI4NSIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjE4cHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIFRDUAogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICA8L2c+CiAgICA8c3dpdGNoPgogICAgICAgIDxnIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIvPgogICAgICAgIDxhIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsLTUpIiB4bGluazpocmVmPSJodHRwczovL3d3dy5kaWFncmFtcy5uZXQvZG9jL2ZhcS9zdmctZXhwb3J0LXRleHQtcHJvYmxlbXMiIHRhcmdldD0iX2JsYW5rIj4KICAgICAgICAgICAgPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIxMHB4IiB4PSI1MCUiIHk9IjEwMCUiPgogICAgICAgICAgICAgICAgVmlld2VyIGRvZXMgbm90IHN1cHBvcnQgZnVsbCBTVkcgMS4xCiAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICA8L2E+CiAgICA8L3N3aXRjaD4KPC9zdmc+" title="SSTP関係図" width="161" height="321" class="img_ev3q"></p><p>SSTP パケットは次の図のような構成をとる。</p><p><img loading="lazy" alt="SSTP パケット" src="/study-docs/assets/images/tunneling-9.drawio-1069836303040b77717980596197629d.svg" title="SSTP パケット" width="701" height="161" class="img_ev3q"></p><ul><li><p><code>Version</code> (8bits)</p><p>使⽤される SSTP のバージョンの通信とネゴシエーションに使⽤されるものである。</p><p>上位 4bit がメジャーバージョンを表し、下位 4bit がマイナーバージョンを表している。</p></li><li><p><code>Reserved</code> (7bits)</p><p>将来の使⽤のために予約されている。0 をセットする。</p></li><li><p><code>C</code> (1bit)</p><p>パケットが SSTP 制御パケットであるかを判断するものである。</p><table><thead><tr><th align="center">bit</th><th align="center">説明</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">制御パケット</td></tr><tr><td align="center">0</td><td align="center">データパケット</td></tr></tbody></table></li><li><p><code>LengthPacket</code> (16bits)</p><p>次のような形式をとる。</p><p><img loading="lazy" alt="LengthPacket" src="/study-docs/assets/images/tunneling-10.drawio-777d43705cb4d566d7f6cc8e7c61d463.svg" title="LengthPacket" width="381" height="81" class="img_ev3q"></p><ul><li><p><code>R</code> (4bits)</p><p>将来の使⽤のために予約されている。0 をセットする。</p></li><li><p><code>Length</code> (12bits)</p><p>バイトサイズであり、4bytes の SSTP ヘッダも含まれる。</p></li></ul></li><li><p><code>Data</code> (可変)</p><p><code>C</code>が 1 であれば制御メッセージが格納され、0 であれば上位プロトコルからのペイロードが格納されている。
SSTP データ パケットは、PPP フレームをペイロードとして通信する。</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sstp-制御パケット">SSTP 制御パケット<a href="#sstp-制御パケット" class="hash-link" aria-label="SSTP 制御パケット への直接リンク" title="SSTP 制御パケット への直接リンク">​</a></h4><p>制御パケットはクライアントとサーバーの両⽅が制御メッセージを相互に送信するために使⽤するパケットであり、以下の形式を取る。</p><p><img loading="lazy" alt="SSTP 制御パケット" src="/study-docs/assets/images/tunneling-11.drawio-bd562bc30bfd57066fe0118e39e53811.svg" title="SSTP 制御パケット" width="701" height="201" class="img_ev3q"></p><p>上位 4bytes は上記で説明したものと全く同じであるので割愛する。</p><ul><li><p><code>Message Type</code> (16bits)</p><p>メッセージのタイプを指定指定しており、次のどれかを指定する必要がある。</p><table><thead><tr><th align="center">Name</th><th align="center">値</th></tr></thead><tbody><tr><td align="center">SSTP_MSG_CALL_CONNECT_REQUEST</td><td align="center">0x0001</td></tr><tr><td align="center">SSTP_MSG_CALL_CONNECT_ACK</td><td align="center">0x0002</td></tr><tr><td align="center">SSTP_MSG_CALL_CONNECT_NAK</td><td align="center">0x0003</td></tr><tr><td align="center">SSTP_MSG_CALL_CONNECTED</td><td align="center">0x0004</td></tr><tr><td align="center">SSTP_MSG_CALL_ABORT</td><td align="center">0x0005</td></tr><tr><td align="center">SSTP_MSG_CALL_DISCONNECT</td><td align="center">0x0006</td></tr><tr><td align="center">SSTP_MSG_CALL_DISCONNECT_ACK</td><td align="center">0x0007</td></tr><tr><td align="center">SSTP_MSG_ECHO_REQUEST</td><td align="center">0x0008</td></tr><tr><td align="center">SSTP_MSG_ECHO_RESPONSE</td><td align="center">0x0009</td></tr></tbody></table></li><li><p><code>Num Attributes</code> (16bits)</p><p>メッセージ内の属性(Attributes)の数を指定するものである。</p></li><li><p><code>Attributes</code> (可変)</p><p>SSTP コントロール メッセージを構成する可変サイズの属性である。
全てを書くと長いので<a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sstp/c50ed240-56f3-4309-8e0c-1644898f0ea8" target="_blank" rel="noopener noreferrer">Microsoft</a>の 2.2.4 章からこの属性についての説明がされている(2023/2/4 現在)。</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sstp-データパケット">SSTP データパケット<a href="#sstp-データパケット" class="hash-link" aria-label="SSTP データパケット への直接リンク" title="SSTP データパケット への直接リンク">​</a></h4><p>SSTP データパケットは、SSTP クライアントと SSTP サーバーの両⽅が上位層のペイロード(つまり、PPP フレーム)を相互に送信するために使⽤する SSTP パケットであり、以下の形式を取る。</p><p><img loading="lazy" alt="SSTP データパケット" src="/study-docs/assets/images/tunneling-9.drawio-1069836303040b77717980596197629d.svg" title="SSTP データパケット" width="701" height="161" class="img_ev3q"></p><ul><li><p><code>Data</code> (可変)</p><p>上位層の可変長のペイロードである。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ipsec">IPsec<a href="#ipsec" class="hash-link" aria-label="IPsec への直接リンク" title="IPsec への直接リンク">​</a></h3><p>IPsec は IP Security の略であり、IP パケットをカプセル化するプロトコルである。IP v4, v6 のどちらでも使用できるプロトコルであり、
<a href="https://www.rfc-editor.org/rfc/rfc4303.html" target="_blank" rel="noopener noreferrer">カプセル化セキュリティペイロード(ESP)</a>または<a href="https://www.rfc-editor.org/rfc/rfc4302.html" target="_blank" rel="noopener noreferrer">認証ヘッダー(AH)</a>の 2 つのヘッダに対応している。</p><p>IPsec ではセキュアな通信を提供するために、2 つのネットワークエンティティ間で共有セキュリティ属性を確立する SA(Security Association) を用いている。</p><p>(IPsec の章において)以降の図で灰色のデータはオプションを意味している。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ip-認証ヘッダah">IP 認証ヘッダ(AH)<a href="#ip-認証ヘッダah" class="hash-link" aria-label="IP 認証ヘッダ(AH) への直接リンク" title="IP 認証ヘッダ(AH) への直接リンク">​</a></h4><p>IP 認証ヘッダ(AH)は、IP データグラムのための完全性と認証を確認し、リプレイ攻撃の対策として使用される。</p><p>AH は次のような構成をとる。</p><p><img loading="lazy" alt="認証ヘッダ(AH)" src="/study-docs/assets/images/tunneling-18.drawio-562eb93274341ccd606770eb84b1159b.svg" title="認証ヘッダ(AH)" width="701" height="241" class="img_ev3q"></p><ul><li><p><code>Next Header</code> (8 bits)</p><p>認証ヘッダの後の次のペイロードのタイプを識別する 8 ビットのフィールドである。<a href="https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml" target="_blank" rel="noopener noreferrer">IANA</a>で定義された IP プロトコル番号のセットが使用される。</p></li><li><p><code>Payload Length</code> (8 bits)</p><p>4 バイト単位であり、最終結果から-2 する必要がある。例えば、整合性チェック値が 96bit のアルゴリズムで決められた値が設定される場合
整合性チェック値以外の 12bytes (3)と整合性チェックの 96bits (12bytes)を足し合わせた<code>6</code>から<code>-2</code>した<code>4</code>が入る。</p><p>なぜ-2 されるのかは謎。</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>原文</summary><div><div class="collapsibleContent_i85q">This 8-bit field specifies the length of AH in 32-bit words (4-byte units), minus &quot;2&quot;. Thus, for example, if an integrity algorithm yields a 96-bit authentication value, this length field will be &quot;4&quot; (3 32-bit word fixed fields plus 3 32-bit words for the ICV, minus 2). For IPv6, the total length of the header must be a multiple of 8-octet units. (Note that although IPv6 [DH98] characterizes AH as an extension header, its length is measured in 32-bit words, not the 64-bit words used by other IPv6 extension headers.) See Section 2.6, &quot;Integrity Check Value (ICV)&quot;, for comments on padding of this field, and Section 3.3.3.2.1, &quot;ICV Padding&quot;.</div></div></details></li><li><p><code>Reserved</code> (16 bits)</p><p>将来の使用のために予約されている。</p></li><li><p><code>Security Parameters Index (SPI)</code> (32 bits)</p><p>受信側が受信するパケットを決定する SA を識別するために使用する任意の 32 ビット値である。
1 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em"></span><span class="mrel">∼</span></span></span></span></span> 255 までの範囲の SPI 値は、将来の使用のため Internet Assigned Numbers Authority（IANA）によって予約されている。</p></li><li><p><code>Sequence Number Field</code> (32 bits)</p><p>パケットを送り合うたびに+1 されるシーケンス番号である。SA が確立した時は送信側・受信側は 0 から開始する。
デフォルトではリプレイ攻撃のためシーケンス番号はループしないようになっているので<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>32</mn></msup></mrow><annotation encoding="application/x-tex">2^{32}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span></span></span></span></span></span></span></span></span>まで増加すると新しい SA を確立する必要がある。</p></li><li><p><code>Integrity Check Value-ICV</code> (可変)</p><p>整合性チェック値であり、このパケットの整合性を確認するために用いられる。また、必ず 32bit(IPv4)または 64bit(IPv6)である必要があるため、パディングされる場合もある。
この値は SA によって定められ、対称鍵暗号化アルゴリズム・SHA-1, SHA-256, MD5 のようなハッシュ関数が用いられる。</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="カプセル化セキュリティペイロードesp">カプセル化セキュリティペイロード(ESP)<a href="#カプセル化セキュリティペイロードesp" class="hash-link" aria-label="カプセル化セキュリティペイロード(ESP) への直接リンク" title="カプセル化セキュリティペイロード(ESP) への直接リンク">​</a></h4><p>カプセル化セキュリティペイロード(ESP)は、IP ヘッダの後の次の層のプロトコルのヘッダの間またはカプセル化された IP ヘッダの前に挿入される。
ESP を使用することで、機密性・送信元認証・コネクションレス完全性・リプレイ攻撃防止・トラフィックの機密性を保つことができる。</p><p>ESP は次のような構造をとる。</p><p><img loading="lazy" alt="カプセル化セキュリティペイロード(ESP)" src="/study-docs/assets/images/tunneling-19.drawio-5c34f61ba9878a77a28eb109f4013ef9.svg" title="カプセル化セキュリティペイロード(ESP)" width="902" height="401" class="img_ev3q"></p><p>ペイロードの詳細は次のようになる。</p><p><img loading="lazy" alt="ペイロード詳細)" src="/study-docs/assets/images/tunneling-20.drawio-afdf32562956b90ba82452811acd52d5.svg" title="ペイロード詳細" width="901" height="401" class="img_ev3q"></p><p>TFC は Traffic Flow Confidentiality の略であり、IPsec のトンネルモードの時に挿入される場合がある。</p><ul><li><p><code>Security Parameters Index (SPI)</code> (32 bits)</p><p>受信側で SA を判別するために使用され、必須のフィールドである。</p></li><li><p><code>Sequence Number</code> (32 bits)</p><p>AH と同じであり、パケットを送り合うたびに+1 されるシーケンス番号である。SA が確立した時は送信側・受信側は 0 から開始する。</p></li><li><p><code>Payload Data</code> (可変)</p><p>次のヘッダフィールドによって記述されるデータを含む可変長フィールドである。</p></li><li><p><code>Padding</code> (0 ~ 255 bits)</p><p>暗号化を行った際に bit の幅を合わせるために使用される。</p></li><li><p><code>Pad Length</code> (8 bits)</p><p>padding の長さを表し、必須フィールドである。</p></li><li><p><code>Next Header</code> (8 bits)</p><p>ペイロードデータフィールドに含まれるデータのタイプを識別する必須の 8 ビットのフィールドで、IANA で定義されている。</p></li><li><p><code>IV</code> (オプション)</p><p>初期化ベクトル</p></li><li><p><code>Traffic Flow Confidentiality</code> (可変)</p><p>データの長さを隠蔽するために使用されるパディングである。</p></li><li><p><code>Integrity Check Value (ICV)</code> (可変)</p><p>整合性を確認するために使用する値。ESP ヘッダ・ペイロード・ESP トレーラフィールドの値から算出される。</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="接続方法モード">接続方法(モード)<a href="#接続方法モード" class="hash-link" aria-label="接続方法(モード) への直接リンク" title="接続方法(モード) への直接リンク">​</a></h4><p>また、IPsec には 2 種類の接続方法が存在する。</p><ul><li>トランスポートモード</li><li>トンネルモード</li></ul><p>トランスポートモードでは IP ヘッダは変更せず、ペイロード部分のみ暗号化するものであり、トンネルモードでは IP ヘッダも暗号化を行い、別の IP ヘッダを付与する。</p><p><img loading="lazy" alt="トランスポートモード・トンネルモード" src="data:image/svg+xml;base64,PHN2ZyBob3N0PSI2NWJkNzExNDRlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIzNDJweCIgaGVpZ2h0PSIxNDJweCIgdmlld0JveD0iLTAuNSAtMC41IDM0MiAxNDIiIGNvbnRlbnQ9IiZsdDtteGZpbGUmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7TVV0Y1VKOWdVeVhGaUR6VDBiWEEmcXVvdDsgbmFtZT0mcXVvdDvjg5rjg7zjgrgxJnF1b3Q7Jmd0OzVaWk5qNXN3RUlaL2plOHhUZ2djZ1UwL0RwVXE1ZEN6aXlkZ3JjR1I0NVNrdjc0bWpDRXVpYnBTZDdPSGxTSmxlR2NHbStjMUl3Z3JtdE5udy9mMU55MUFrV2doVG9ROWtTaWlkRTNkWDYrY0J5V21pMEdvakJSWU5BbGIrUnRROUdWSEtlQVFGRnF0bFpYN1VDeDEyMEpwQTQwYm83dXdiS2RWdU9xZVZ6QVR0aVZYYy9XSEZMWWUxQ1JhVC9vWGtGWHRWNlp4T21RYTdvdnhTUTQxRjdxN2t0aUdzTUpvYlllb09SV2dlbmlleTlEMzZVNTIzSmlCMXI2a0lZbUdqbDljSGZIaHZuNG5HMFlTUnRJRUEvZkR3Ty9hbmowS280K3RnUDV1QzhMeXJwWVd0bnRlOXRuT21lKzAyamJLWFZFWDRscGdMSnp1YnBpT0dOejVBZDJBTldkWDRodGkzQU1lblpGa054bEJ2VlpmbWJCRWphUDMxWGpyQ1k4TGtOQWRXbXhHeTdQS0xrRkVzaVVxMlJNR2VlSHBwZjlIYnllVktyVFM1dExMZGtrSlplbjBnelg2R2E0eVA1UFZjclY0STk3eEkzbXY3dkZPL05uTVVvK1pvUU81VjlLNUEyTlg5QUp6SERRYk9oQ1NiblVMZjltQ0VsZXlhdDFsNlNDRDAvUGVBdW5tUjRhSlJnclJMM1BUOHZCUXZJYUhxOUJEZXN2RDVRMFAyV3Q0R0Q5eXdyekxPOExlZFNhdFA5eE1tdkYrNkV4Sy9qbVQ4dkUwZTk1Wi9pRUhEM3ZnNEhHWDAyZlRKWGYxOGNrMmZ3QT0mbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7Ij4KICAgIDxkZWZzLz4KICAgIDxnPgogICAgICAgIDxyZWN0IHg9IjEwIiB5PSI2MCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI0MCIgZmlsbD0icmdiKDI1NSwgMjU1LCAyNTUpIiBzdHJva2U9InJnYigwLCAwLCAwKSIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxMThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiA4MHB4OyBtYXJnaW4tbGVmdDogMTFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElQ44OY44OD44OACiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2ZvcmVpZ25PYmplY3Q+CiAgICAgICAgICAgICAgICA8dGV4dCB4PSI3MCIgeT0iODQiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMnB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgICAgICAgICAgICAgICAgICBJUOODmOODg+ODgAogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHJlY3QgeD0iMTAiIHk9IjEwMCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI0MCIgZmlsbD0iI2Y4Y2VjYyIgc3Ryb2tlPSIjYjg1NDUwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDExOHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDEyMHB4OyBtYXJnaW4tbGVmdDogMTFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOODmuOCpOODreODvOODiQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iNzAiIHk9IjEyNCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIOODmuOCpOODreODvOODiQogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjE0MCIgaGVpZ2h0PSIzMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDEzOHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDE1cHg7IG1hcmdpbi1sZWZ0OiAxcHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICIgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMnB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDjg4jjg6njg7Pjgrnjg53jg7zjg4jjg6Ljg7zjg4kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICAgIDx0ZXh0IHg9IjcwIiB5PSIxOSIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIOODiOODqeODs+OCueODneODvOODiOODouODvOODiQogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHJlY3QgeD0iMjEwIiB5PSI2MCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI0MCIgZmlsbD0iI2Y4Y2VjYyIgc3Ryb2tlPSIjYjg1NDUwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDExOHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDgwcHg7IG1hcmdpbi1sZWZ0OiAyMTFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElQ44OY44OD44OACiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2ZvcmVpZ25PYmplY3Q+CiAgICAgICAgICAgICAgICA8dGV4dCB4PSIyNzAiIHk9Ijg0IiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+CiAgICAgICAgICAgICAgICAgICAgSVDjg5jjg4Pjg4AKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxyZWN0IHg9IjIxMCIgeT0iMTAwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjZjhjZWNjIiBzdHJva2U9IiNiODU0NTAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTE4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTIwcHg7IG1hcmdpbi1sZWZ0OiAyMTFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOODmuOCpOODreODvOODiQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iMjcwIiB5PSIxMjQiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMnB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgICAgICAgICAgICAgICAgICDjg5rjgqTjg63jg7zjg4kKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxyZWN0IHg9IjIwMCIgeT0iMCIgd2lkdGg9IjE0MCIgaGVpZ2h0PSIzMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDEzOHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDE1cHg7IG1hcmdpbi1sZWZ0OiAyMDFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOODiOODs+ODjeODq+ODouODvOODiQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iMjcwIiB5PSIxOSIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIOODiOODs+ODjeODq+ODouODvOODiQogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICA8L2c+CiAgICA8c3dpdGNoPgogICAgICAgIDxnIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIvPgogICAgICAgIDxhIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsLTUpIiB4bGluazpocmVmPSJodHRwczovL3d3dy5kaWFncmFtcy5uZXQvZG9jL2ZhcS9zdmctZXhwb3J0LXRleHQtcHJvYmxlbXMiIHRhcmdldD0iX2JsYW5rIj4KICAgICAgICAgICAgPHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIxMHB4IiB4PSI1MCUiIHk9IjEwMCUiPgogICAgICAgICAgICAgICAgVmlld2VyIGRvZXMgbm90IHN1cHBvcnQgZnVsbCBTVkcgMS4xCiAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICA8L2E+CiAgICA8L3N3aXRjaD4KPC9zdmc+" title="トランスポートモード・トンネルモード" width="342" height="142" class="img_ev3q"></p><p>トランポートモードでは IP ヘッダがそのままなので、送信元から宛先までの全区間で IPsec が行われている状態であるため、送信元・宛先両方が IPsec に対応している必要がある。</p><p>トンネルモードでは別の IP ヘッダを付与しているため、オリジナル IP ヘッダ(暗号化された IP ヘッダ)はそのままである。そのため、送信元と宛先の途中の一部だけ IPsec を行うということが
可能となる。</p><p><img loading="lazy" alt="トランスポートモード・トンネルモード通信" src="/study-docs/assets/images/tunneling-13.drawio-e78a20838f5ecb1effb519a8ef0e6298.svg" title="トランスポートモード・トンネルモード通信" width="611" height="521" class="img_ev3q"></p><p>つまり、IPsec には接続方法 2 種類 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span> ヘッダー 2 種類で合計 4 パターン存在する。</p><ul><li>トランスポートモード・AH ヘッダ</li><li>トランスポートモード・ESP ヘッダ</li><li>トンネルモード・AH ヘッダ</li><li>トンネルモード・ESP ヘッダ</li></ul><p>トランスポートモード・AH ヘッダの場合の IP ヘッダは次のような形式になる。</p><p><img loading="lazy" alt="トランスポートモード・AH" src="/study-docs/assets/images/tunneling-21.drawio-b08a19ff37621541dc6af7d47c9083b8.svg" title="トランスポートモード・AH" width="1051" height="661" class="img_ev3q"></p><p>トンネルモード・AH ヘッダの場合の IP ヘッダは次のような形式になる。</p><p><img loading="lazy" alt="トンネルモード・AH" src="/study-docs/assets/images/tunneling-22.drawio-4b6b5a2c70bb2404a8fdc37a44767ae8.svg" title="トンネルモード・AH" width="1211" height="662" class="img_ev3q"></p><p>トランスポートモード・ESP ヘッダの場合の IP ヘッダは次のような形式になる。</p><p><img loading="lazy" alt="トランスポートモード・ESP" src="/study-docs/assets/images/tunneling-23.drawio-72278b7dde0d34ece5cb2d9be3aef1a1.svg" title="トランスポートモード・ESP" width="1361" height="681" class="img_ev3q"></p><p>トンネルモード・ESP ヘッダの場合の IP ヘッダは次のような形式になる。</p><p><img loading="lazy" alt="トンネルモード・ESP" src="/study-docs/assets/images/tunneling-24.drawio-9c8237036226349c010db4b38d593469.svg" title="トンネルモード・ESP" width="1521" height="681" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ikev2-internet-key-exchange-protocol-version-2">IKEv2 (Internet Key Exchange Protocol Version 2)<a href="#ikev2-internet-key-exchange-protocol-version-2" class="hash-link" aria-label="IKEv2 (Internet Key Exchange Protocol Version 2) への直接リンク" title="IKEv2 (Internet Key Exchange Protocol Version 2) への直接リンク">​</a></h4><p>IPsec の鍵交換にためのプロトコルであり、<a href="https://www.rfc-editor.org/rfc/rfc7296.html" target="_blank" rel="noopener noreferrer">RFC7296</a>で定義されている。</p><p>IKE はそれぞれの通信間で相互認証を実行し、カプセル化セキュリティペイロード(ESP)または認証ヘッダー(AH)の SA を効率的に確立するために
使用できる共有秘密鍵を含む IKE Security Association(SA)を確立する。</p><p>IKE メッセージを送信する側を<code>イニシエータ</code>と呼び、応答を返す側を<code>レスポンダ</code>と呼ぶ。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="ヘッダー">ヘッダー<a href="#ヘッダー" class="hash-link" aria-label="ヘッダー への直接リンク" title="ヘッダー への直接リンク">​</a></h5><p>IKE ヘッダーは次のような構成をとる。</p><p><img loading="lazy" alt="IKE ヘッダー" src="/study-docs/assets/images/tunneling-27.drawio-ba9ec788fa0a77ab850048e0058e24dd.svg" title="IKE ヘッダー" width="701" height="321" class="img_ev3q"></p><ul><li><p><code>IKE SA Initiator&#x27;s SPI</code> (64 bits)</p><p>一意の IKE SA を識別するためにイニシエーターによって選択された値。0 であってはならない。</p></li><li><p><code>IKE SA Responder&#x27;s SPI</code> (64 bits)</p><p>一意の IKE SA を識別するためにレスポンダによって選択された値。一番はじめのメッセージでは 0 でなければならない。</p></li><li><p><code>Next Payload</code> (8 bits)</p><p>ヘッダーの直後に続くペイロードのタイプを示す。</p><table><thead><tr><th align="center">Next Payload Type</th><th align="center">Notation</th><th align="center">Value</th></tr></thead><tbody><tr><td align="center">No Next Payload</td><td align="center"></td><td align="center">0</td></tr><tr><td align="center">Security Association</td><td align="center">SA</td><td align="center">33</td></tr><tr><td align="center">Key Exchange</td><td align="center">KE</td><td align="center">34</td></tr><tr><td align="center">Identification - Initiator</td><td align="center">IDi</td><td align="center">35</td></tr><tr><td align="center">Identification - Responder</td><td align="center">IDr</td><td align="center">36</td></tr><tr><td align="center">Certificate</td><td align="center">CERT</td><td align="center">37</td></tr><tr><td align="center">Certificate Request</td><td align="center">CERTREQ</td><td align="center">38</td></tr><tr><td align="center">Authentication</td><td align="center">AUTH</td><td align="center">39</td></tr><tr><td align="center">Nonce</td><td align="center">Ni, Nr</td><td align="center">40</td></tr><tr><td align="center">Notify</td><td align="center">N</td><td align="center">41</td></tr><tr><td align="center">Delete</td><td align="center">D</td><td align="center">42</td></tr><tr><td align="center">Vendor ID</td><td align="center">V</td><td align="center">43</td></tr><tr><td align="center">Traffic Selector - Initiator</td><td align="center">TSi</td><td align="center">44</td></tr><tr><td align="center">Traffic Selector - Responder</td><td align="center">TSr</td><td align="center">45</td></tr><tr><td align="center">Encrypted and Authenticated</td><td align="center">SK</td><td align="center">46</td></tr><tr><td align="center">Configuration</td><td align="center">CP</td><td align="center">47</td></tr><tr><td align="center">Extensible Authentication</td><td align="center">EAP</td><td align="center">48</td></tr></tbody></table></li><li><p><code>Major Version</code> (4 bits)</p><p>使用中の IKE プロトコルのメジャーバージョンを示す。このバージョンの IKE に基づく実装では、メジャーバージョンを 2 に設定する必要がある。以前のバージョンの IKE および ISAKMP に基づく実装では、メジャーバージョンを 1 に設定する必要がある。</p></li><li><p><code>Minor Version</code> (4 bits)</p><p>使用中の IKE プロトコルのマイナーバージョンを示す。このバージョンの IKE に基づく実装は、マイナーバージョンを 0 に設定する必要がある。受信したメッセージのマイナーバージョン番号を無視する必要がある。</p></li><li><p><code>Exchange Type</code> (8 bits)</p><p>使用されている交換のタイプを示す。これにより、交換で各メッセージで送信されるペイロードが制限される。</p><table><thead><tr><th align="center">Exchange Type</th><th align="center">Value</th></tr></thead><tbody><tr><td align="center">Reserved</td><td align="center">0 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em"></span><span class="mrel">∼</span></span></span></span></span> 33</td></tr><tr><td align="center">IKE_SA_INIT</td><td align="center">34</td></tr><tr><td align="center">IKE_AUTH</td><td align="center">35</td></tr><tr><td align="center">CREATE_CHILD_SA</td><td align="center">36</td></tr><tr><td align="center">INFORMATIONAL</td><td align="center">37</td></tr><tr><td align="center">IKE_SESSION_RESUME</td><td align="center">38</td></tr><tr><td align="center">GSA_AUTH</td><td align="center">39</td></tr><tr><td align="center">GSA_REGISTRATION</td><td align="center">40</td></tr><tr><td align="center">GSA_REKEY</td><td align="center">41</td></tr><tr><td align="center">Unassigned</td><td align="center">42</td></tr><tr><td align="center">IKE_INTERMEDIATE</td><td align="center">43</td></tr><tr><td align="center">IKE_FOLLOWUP_KE</td><td align="center">44</td></tr><tr><td align="center">Unassigned</td><td align="center">45 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em"></span><span class="mrel">∼</span></span></span></span></span> 239</td></tr><tr><td align="center">Private use</td><td align="center">240 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em"></span><span class="mrel">∼</span></span></span></span></span> 255</td></tr></tbody></table><p>最新のものについては<a href="https://www.iana.org/assignments/ikev2-parameters/ikev2-parameters.xhtml" target="_blank" rel="noopener noreferrer">IANA</a>に記載されている。</p></li><li><p><code>Flags</code> (8 bits)</p><p>メッセージに設定されている特定のオプションを示す。</p><p><img loading="lazy" alt="IKE ヘッダー Flags" src="/study-docs/assets/images/tunneling-27.drawio-ba9ec788fa0a77ab850048e0058e24dd.svg" title="IKE ヘッダー Flags" width="701" height="321" class="img_ev3q"></p><ul><li><p><code>X</code></p><p>送信時には 0 とし、受信時は無視する必要がある。</p></li><li><p><code>R</code></p><p>このビットは、このメッセージが同じメッセージ ID を含むメッセージへの応答であることを示す。このビットは、すべての要求メッセージでクリアする必要があり、すべての応答で設定する必要がある。</p></li><li><p><code>V</code></p><p>このビットは、送信機が、メジャーバージョン番号フィールドに示されているものよりも高いプロトコルのメジャーバージョン番号を読み込めることを示す。 IKEv2 の実装では、送信時にこのビットを 0 にする必要があり、受信メッセージでは無視する必要がある。</p></li><li><p><code>I</code></p><p>このビットは、IKE SA の元のイニシエーターが送信したメッセージで設定する必要があり、レスポンダーが送信したメッセージで 0 にする必要がある。</p></li></ul></li><li><p><code>Message ID</code> (32 bits)</p><p>失われたパケットの再送信および要求と応答のマッチングを制御するために使用されるメッセージ ID。メッセージ再生攻撃を防ぐために使用されるため、プロトコルのセキュリティに不可欠である。詳細はセクション 2.1 と 2.2 に記載されている。</p></li><li><p><code>Length</code> (32 bits)</p><p>バイト単位の合計メッセージ（ヘッダー+ペイロード）の長さ。</p></li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="通信">通信<a href="#通信" class="hash-link" aria-label="通信 への直接リンク" title="通信 への直接リンク">​</a></h5><p>IKE を使用した通信は、常に IKE_SA_INIT および IKE_AUTH 交換（IKEv1 ではフェーズ 1 として知られている）で始まり、
最初の交換は通常 4 つのメッセージで構成されるが、シナリオ(AH なのか ESP なのかトンネルモードなのかトランスポートモードなのか)によって増える場合がある。</p><p>メッセージの初めは IKE_SA_INIT であり、暗号アルゴリズムやノンスを<a href="/study-docs/docs/Network/diffie-hellman">Diffie-Hellman 鍵交換方式</a>で交換する。</p><p>2 番目のメッセージは IKE_AUTH であり、前のメッセージの認証, 身元・証明書の交換を行い、IKE SA を確立する。</p><p>最初の交換に続くすべてのメッセージは IKE_SA_INIT で決定された暗号化アルゴリズムとキーを使用して暗号化されて保護される。</p><p>すべての IKE メッセージには、固定ヘッダーの一部としてメッセージ ID が含まれている。
このメッセージ ID は、リクエストとレスポンスを照合し、メッセージの再送信を識別するために使用される。</p><table><thead><tr><th align="center">Notation</th><th align="center">Payload</th></tr></thead><tbody><tr><td align="center">AUTH</td><td align="center">Authentication</td></tr><tr><td align="center">CERT</td><td align="center">Certificate</td></tr><tr><td align="center">CERTREQ</td><td align="center">Certificate Request</td></tr><tr><td align="center">CP</td><td align="center">Configuration</td></tr><tr><td align="center">D</td><td align="center">Delete</td></tr><tr><td align="center">EAP</td><td align="center">Extensible Authentication</td></tr><tr><td align="center">HDR</td><td align="center">IKE header (not a payload)</td></tr><tr><td align="center">IDi</td><td align="center">Identification - Initiator</td></tr><tr><td align="center">IDr</td><td align="center">Identification - Responder</td></tr><tr><td align="center">KE</td><td align="center">Key Exchange</td></tr><tr><td align="center">Ni, Nr</td><td align="center">Nonce</td></tr><tr><td align="center">N</td><td align="center">Notify</td></tr><tr><td align="center">SA</td><td align="center">Security Association</td></tr><tr><td align="center">SK</td><td align="center">Encrypted and Authenticated</td></tr><tr><td align="center">TSi</td><td align="center">Traffic Selector - Initiator</td></tr><tr><td align="center">TSr</td><td align="center">Traffic Selector - Responder</td></tr><tr><td align="center">V</td><td align="center">Vendor ID</td></tr></tbody></table><p>イニシエータの初めのメッセージは次のような形式をしている。</p><p><img loading="lazy" alt="IKE Request 1" src="data:image/svg+xml;base64,PHN2ZyBob3N0PSI2NWJkNzExNDRlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI2NDFweCIgaGVpZ2h0PSI4MXB4IiB2aWV3Qm94PSItMC41IC0wLjUgNjQxIDgxIiBjb250ZW50PSImbHQ7bXhmaWxlJmd0OyZsdDtkaWFncmFtIGlkPSZxdW90O01VdGNVSjlnVXlYRmlEelQwYlhBJnF1b3Q7IG5hbWU9JnF1b3Q744Oa44O844K4MSZxdW90OyZndDszVmROYzVzd0VQMDF6TFFIendDS01Ua21ydHRtTXUzRmg1NkZXRUNOa0tnUS91aXZyd1FDVEdOY2s5S20wd3NSYjNldC9YajdIRHRvblI4K1NGeGtuMFFNelBIZCtPQ2dkNDd2aDc2cm53WTROc0NOdjJxQVZOSzRnYndlMk5MdllFRWJsMVkwaG5MZ3FJUmdpaFpEa0FqT2dhZ0JocVVVKzZGYkl0ancxZ0tuOEF6WUVzeWVvMTlvckxLMnJGV1Bmd1NhWnUzTlhuRGJXSExjT3R0S3lnekhZbjhDb1kyRDFsSUkxWnp5d3hxWTZWM2JseWJ1L1lpMVMwd0NWMWNGdEluc01LdHNkWTRmTUIxOFh4YVlteFRWMGRZZGZLdE1YdmRFTUNFZGRLZU5NbzNlK0tGalBtV3RuOGp0aitpdE9hUDd1c0ZjTFJLY1UzWnN3aHFYOWhuZ3ZLZ2RFYm94OTBJcVFCc3Erc3cwSGlSRkpKU1lFRkJGRlZmVmhBQ0N1ZEo5TmUyN09vYlhPYmtsNXVWNGxMRXVTcEEwdWRDVFk2a2dYMHhxeVl2Nm1BSGJnYUlFVDRqQmt1SUxYYm1tUGx3VURPcU5OZFR5WGNqRjE1ZlcrbnZCNVRHUHhQbHFlaTZYdFNRWkpudEJjZWczUTU5UzgvZmhjYU50R2VBWVpMdE9lZ21ialdwYzdQNTN5K1ZMVWZFWXpGNmFtL1laVmJBdE1ESFd2VlpSTXh1Vk0vM202V05DR1ZzM2E2aGpVUklTSU1TVW9xUjRnaE5MRkM1dmxtNTMzdzZrZ3NPb1dIaWRCR25wQnBHRGtrZnRZZ044MTRwRks5dnQrNzRYUVMrd1dIWWlnS0hGc05YZHRQdm9YcHIwd2FyVG1GSjUwNVZLMTZvV21OR1VOOU5hN0NGNm9tcEJkTVZtTW5hbXRSdlYzVGQ5TUg2dUdhbzF4clFzR0xiQ1JUbWpISG95TUlGdENCY0cvNWtJYllhR05SMjlUelBVSS9LSUI2YTRzZGpSNnE2aTRoWklKYWt5WTd3clMwRW9WbFR3VVZKMmNKUHhFSTdrdjFQWEE2ZEsxMUtyaFRkWE9YOTBSeE1JenU5b3ZMcU4zSmwyRkFXdnVxUCs2STVhcHJ4dzJvOWdhdHdjU0laNUN1TURuT0YvbGd0RXUwaXlzMndhMG01V05pWCtDSnVDS0ZnRzg3QnA2YjhxbTlBdjJEU25ubndXbk1Ea0VVKzcwMzVyL0c5Y2pER0V5Vmt1QmlTRUtKbUhpMEg0OTdpb1gvdmZZTFh0NUljczJ2d0EmbHQ7L2RpYWdyYW0mZ3Q7Jmx0Oy9teGZpbGUmZ3Q7Ij4KICAgIDxkZWZzLz4KICAgIDxnPgogICAgICAgIDxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxNjAiIGhlaWdodD0iODAiIGZpbGw9IiNmOGNlY2MiIHN0cm9rZT0iI2I4NTQ1MCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxNThweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiA0MHB4OyBtYXJnaW4tbGVmdDogMXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTJweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOiByZ2IoMjggLCAzMCAsIDMzKSA7IGZvbnQtZmFtaWx5OiAsICwgJnF1b3Q7c2Vnb2UgdWkmcXVvdDsgLCAmcXVvdDtyb2JvdG8mcXVvdDsgLCAmcXVvdDt1YnVudHUmcXVvdDsgLCAmcXVvdDtjYW50YXJlbGwmcXVvdDsgLCAmcXVvdDtub3RvIHNhbnMmcXVvdDsgLCBzYW5zLXNlcmlmICwgJnF1b3Q7c3lzdGVtLXVpJnF1b3Q7ICwgJnF1b3Q7c2Vnb2UgdWkmcXVvdDsgLCAmcXVvdDtoZWx2ZXRpY2EmcXVvdDsgLCAmcXVvdDthcmlhbCZxdW90OyAsIHNhbnMtc2VyaWYgLCAmcXVvdDthcHBsZSBjb2xvciBlbW9qaSZxdW90OyAsICZxdW90O3NlZ29lIHVpIGVtb2ppJnF1b3Q7ICwgJnF1b3Q7c2Vnb2UgdWkgc3ltYm9sJnF1b3Q7IDsgZm9udC1zaXplOiAxNnB4Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSUtFIGhlYWRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICAgIDx0ZXh0IHg9IjgwIiB5PSI0NCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIElLRSBoZWFkZXIKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxyZWN0IHg9IjE2MCIgeT0iMCIgd2lkdGg9IjE2MCIgaGVpZ2h0PSI4MCIgZmlsbD0iI2ZmZTZjYyIgc3Ryb2tlPSIjZDc5YjAwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDE1OHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDQwcHg7IG1hcmdpbi1sZWZ0OiAxNjFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJ0ZXh0LWFsaWduOiAtd2Via2l0LWNlbnRlciA7IHRleHQtaW5kZW50OiAwcHggOyBkaXNwbGF5OiBpbmxpbmUgOyBmbG9hdDogbm9uZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxmb250IGNvbG9yPSIjMWMxZTIxIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6IDE2cHgiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlY3VyaXR5IEFzc29jaWF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZm9udD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGZvbnQgY29sb3I9IiMxYzFlMjEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTogMTZweCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5pdGlhdG9yIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9mb250PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICAgIDx0ZXh0IHg9IjI0MCIgeT0iNDQiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMnB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgICAgICAgICAgICAgICAgICBTZWN1cml0eSBBc3NvY2lhdGlvbi4uLgogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHJlY3QgeD0iMzIwIiB5PSIwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjZmZmMmNjIiBzdHJva2U9IiNkNmI2NTYiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogNDBweDsgbWFyZ2luLWxlZnQ6IDMyMXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTJweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGZvbnQgc3R5bGU9ImZvbnQtc2l6ZTogMTZweCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtleSBFeGNoYW5nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0iY29sb3I6IHJnYigyOCAsIDMwICwgMzMpIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluaXRpYXRvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxici8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9mb250PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iNDAwIiB5PSI0NCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIEtleSBFeGNoYW5nZS4uLgogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHJlY3QgeD0iNDgwIiB5PSIwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjZGFlOGZjIiBzdHJva2U9IiM2YzhlYmYiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogNDBweDsgbWFyZ2luLWxlZnQ6IDQ4MXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1kcmF3aW8tY29sb3JzPSJjb2xvcjogcmdiKDAsIDAsIDApOyAiIHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDBweDsgdGV4dC1hbGlnbjogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTJweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgb3ZlcmZsb3ctd3JhcDogbm9ybWFsOyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGZvbnQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6IDE2cHgiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTm9uY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOiAxNnB4IDsgY29sb3I6IHJnYigyOCAsIDMwICwgMzMpIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluaXRpYXRvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxici8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9mb250PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iNTYwIiB5PSI0NCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIE5vbmNlLi4uCiAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgIDwvc3dpdGNoPgogICAgICAgIDwvZz4KICAgIDwvZz4KICAgIDxzd2l0Y2g+CiAgICAgICAgPGcgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ii8+CiAgICAgICAgPGEgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtNSkiIHhsaW5rOmhyZWY9Imh0dHBzOi8vd3d3LmRpYWdyYW1zLm5ldC9kb2MvZmFxL3N2Zy1leHBvcnQtdGV4dC1wcm9ibGVtcyIgdGFyZ2V0PSJfYmxhbmsiPgogICAgICAgICAgICA8dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjEwcHgiIHg9IjUwJSIgeT0iMTAwJSI+CiAgICAgICAgICAgICAgICBWaWV3ZXIgZG9lcyBub3Qgc3VwcG9ydCBmdWxsIFNWRyAxLjEKICAgICAgICAgICAgPC90ZXh0PgogICAgICAgIDwvYT4KICAgIDwvc3dpdGNoPgo8L3N2Zz4=" title="IKE Request 1" width="641" height="81" class="img_ev3q"></p><p>このパケットの Security Association - Initiator 1 ではイニシエータが IKE SA に対してサポートしている暗号化アルゴリズムを示している。
Key Exchange - Initiator では Diffie-Hellman 値を送信している。</p><p>これに対するレスポンダの応答は次のような形式を取る。</p><p><img loading="lazy" alt="IKE Response 1" src="/study-docs/assets/images/tunneling-15.drawio-06650a9f8dc1787175c5f6703dba766f.svg" title="IKE Response 1" width="801" height="81" class="img_ev3q"></p><p>Security Association - Responder 1 で選択した暗号スイートを表し、
Key Exchange - Responder で Diffie-Hellman 交換を終了させる。</p><p>この時点で SKEYSEED と呼ばれる値を生成することができ、IKE SA 用の鍵が全て導出することができる。
今後のメッセージはヘッダを除いて、暗号化が行われ、完全性が担保される。</p><p>イニシエータの次のメッセージは次のような形式をとる。</p><p><img loading="lazy" alt="IKE Request 2" src="/study-docs/assets/images/tunneling-16.drawio-46312db7bbe73eb63f8f373c3b0d99ef.svg" title="IKE Request 2" width="1602" height="162" class="img_ev3q"></p><p>Identification - Initiator でイニシエータの身元を主張し、整合性は Authentication ペイロードを使用する。
証明書を Certificate ペイロードで送信し、トラストアンカーのリストを Certificate Request ペイロードで送信する場合がある。</p><p>Traffic Selector は、アドレス範囲（IPv4 または IPv6）、ポート範囲、および IP プロトコル ID で構成される。</p><p>Security Association - Initiator 2 ペイロードを使用して子 SA(IPsec SA) のネゴシエーションを開始する。</p><p>このメッセージに対するレスポンダの応答は次のような形式を取る。</p><p><img loading="lazy" alt="IKE Response 2" src="/study-docs/assets/images/tunneling-17.drawio-4dd46148fe80fabea379a3b6c9cac375.svg" title="IKE Response 2" width="1281" height="161" class="img_ev3q"></p><p>レスポンダは Identification - Responder で自身身元を証明する。オプションで証明書を 1 枚以上送信し、身元認証を行うことで 2 番目のメッセージの完全性を証明する。
これにより子 SA(IPsec SA) のネゴシエーションを完了し、
IKE_AUTH の通信を行ったもの同士がすべての署名とメッセージ認証コード(MAC)が正しく計算されていることを確認する必要がある。</p><p>CREATE_CHILD_SA exchange を使用して新しい SA の作成や IKE SA や Child SA のリキーを行う。
CREATE_CHILD_SA exchange は IKE v1 ではフェーズ 2 と呼ばれている。
SA は新しい SA を生成してから古い SA を削除することでリキーが行われる。
<a href="https://www.rfc-editor.org/rfc/rfc7296.html" target="_blank" rel="noopener noreferrer">RFC7296</a>セクション 2.8 は、古い SA から新しい SA へのトラフィックの移動や古い SA の削除など、リキーの仕組みを説明している。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vxlan">VXLAN<a href="#vxlan" class="hash-link" aria-label="VXLAN への直接リンク" title="VXLAN への直接リンク">​</a></h3><p>VXLAN は Virtual eXtensible Local Area Network の略である。
仮想 LAN（VLAN）の現在の制限は 4094 であり、現在の VM(Virtual Machine)のグループ分けには不十分である。そのため、この問題を解決する方法として VXLAN が登場した。
同じ VXLAN セグメント内の VM のみが相互に通信でき、各 VXLAN セグメントは、<code>VXLAN Network Identifier (VNI)</code>と呼ばれる 24 ビットのセグメント ID によって識別される。
VNI は、VM から発信された内部 MAC フレームをカプセル化する外部ヘッダーにある。</p><p>VXLAN は次のような形でカプセル化を行う。</p><p><img loading="lazy" alt="VXLANカプセル化" src="/study-docs/assets/images/tunneling-25.drawio-ca70523576147f543929e05f95b53544.svg" title="VXLANカプセル化" width="1121" height="81" class="img_ev3q"></p><p>VXLAN ヘッダは次のような形式を取る</p><p><img loading="lazy" alt="VXLANヘッダ" src="/study-docs/assets/images/tunneling-26.drawio-4056b86fdf7915933b920285a5c1b4cf.svg" title="VXLANヘッダ" width="701" height="121" class="img_ev3q"></p><ul><li><p><code>I, R</code> (8 bits)</p><p>フラグであり、有効な VXLAN であれば I は 1 である必要がある。R は予約領域であり、送信時は 0 にし、受信時には無視する。</p></li><li><p><code>Reserved</code> (24 bits, 8 bits)</p><p>予約領域であり、送信時は 0 にし、受信時には無視する。</p></li><li><p><code>VXLAN Network Identifier (VNI)</code> (24 bits)</p><p>セグメント ID である。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a href="#参考" class="hash-link" aria-label="参考 への直接リンク" title="参考 への直接リンク">​</a></h2><ul><li><a href="https://dictionary.goo.ne.jp/word/%E3%82%B9%E3%83%88%E3%83%AA%E3%82%AF%E3%83%88%E3%82%BD%E3%83%BC%E3%82%B9%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/" target="_blank" rel="noopener noreferrer">Strict Source Route</a></li><li><a href="https://www.okta.com/jp/identity-101/hmac/" target="_blank" rel="noopener noreferrer">https://www.okta.com/jp/identity-101/hmac/</a></li><li><a href="https://it-trend.jp/encryption/article/64-0091" target="_blank" rel="noopener noreferrer">https://it-trend.jp/encryption/article/64-0091</a></li><li><a href="https://en.wikipedia.org/wiki/Secure_Socket_Tunneling_Protocol" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Secure_Socket_Tunneling_Protocol</a></li><li><a href="https://amnimo.com/column/037/" target="_blank" rel="noopener noreferrer">https://amnimo.com/column/037/</a></li><li><a href="https://www.infraexpert.com/study/ipsec6.html" target="_blank" rel="noopener noreferrer">https://www.infraexpert.com/study/ipsec6.html</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>タグ:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/study-docs/docs/tags/ネットワーク">ネットワーク</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/koseki2580/study-docs/edit/main/docs/30-Network/10-tunneling.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated"><b><time datetime="2023-09-23T10:07:49.000Z">2023年9月23日</time></b>に<b>koseki2580</b>が<!-- -->最終更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/study-docs/docs/Network/ip-packet"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">IP パケット</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/study-docs/docs/Network/diffie-hellman"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">Diffie-Hellman鍵交換方式</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#トンネリング" class="table-of-contents__link toc-highlight">トンネリング</a><ul><li><a href="#ip-in-ip" class="table-of-contents__link toc-highlight">IP in IP</a></li><li><a href="#sitipv6" class="table-of-contents__link toc-highlight">SIT/IPv6</a></li><li><a href="#gre" class="table-of-contents__link toc-highlight">GRE</a></li><li><a href="#openvpn" class="table-of-contents__link toc-highlight">OpenVPN</a><ul><li><a href="#static-key" class="table-of-contents__link toc-highlight">Static Key</a></li><li><a href="#tls" class="table-of-contents__link toc-highlight">TLS</a></li></ul></li><li><a href="#sstp" class="table-of-contents__link toc-highlight">SSTP</a><ul><li><a href="#sstp-制御パケット" class="table-of-contents__link toc-highlight">SSTP 制御パケット</a></li><li><a href="#sstp-データパケット" class="table-of-contents__link toc-highlight">SSTP データパケット</a></li></ul></li><li><a href="#ipsec" class="table-of-contents__link toc-highlight">IPsec</a><ul><li><a href="#ip-認証ヘッダah" class="table-of-contents__link toc-highlight">IP 認証ヘッダ(AH)</a></li><li><a href="#カプセル化セキュリティペイロードesp" class="table-of-contents__link toc-highlight">カプセル化セキュリティペイロード(ESP)</a></li><li><a href="#接続方法モード" class="table-of-contents__link toc-highlight">接続方法(モード)</a></li><li><a href="#ikev2-internet-key-exchange-protocol-version-2" class="table-of-contents__link toc-highlight">IKEv2 (Internet Key Exchange Protocol Version 2)</a><ul><li><a href="#ヘッダー" class="table-of-contents__link toc-highlight">ヘッダー</a></li><li><a href="#通信" class="table-of-contents__link toc-highlight">通信</a></li></ul></li></ul></li><li><a href="#vxlan" class="table-of-contents__link toc-highlight">VXLAN</a></li></ul></li><li><a href="#参考" class="table-of-contents__link toc-highlight">参考</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/study-docs/assets/js/runtime~main.d23398ad.js"></script>
<script src="/study-docs/assets/js/main.eb6b068a.js"></script>
</body>
</html>