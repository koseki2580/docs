---
title: 平成29年
sidebar_label: 平成29年
draft: true
toc_max_heading_level: 5
tags: [データベース, 資格, データベーススペシャリスト, 午後1, 午後2]
---

```mdx-code-block
import UnderLine from "@site/src/components/Custom/UnderLine"
import FontColor from "@site/src/components/Custom/FontColor"

```

:::caution 注意事項
一個人の解答からここが根拠だろうという部分を取り出してまとめたものになります。
:::
以下の写真は全て実際の問題よりスクリーンショットで取得したものを表示させています。
また、「」内の文字は問題からそのまま引用しています。

## 午後 1

出典 : 平成 29 年度 春期 データベーススペシャリスト試験　午後 1

[問題](https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2017h29_1/2017h29h_db_pm1_qs.pdf)

[解答](https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2017h29_1/2017h29h_db_pm1_ans.pdf)

問題と解答は上記からダウンロードすることができます。

解答作成中

## 午後 2

出典 : 平成 29 年度 春期 データベーススペシャリスト試験　午後 2

[問題](https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2017h29_1/2017h29h_db_pm2_qs.pdf)

[解答](https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2017h29_1/2017h29h_db_pm2_ans.pdf)

問題と解答は上記からダウンロードすることができます。

### 大問 1

#### 設問 1

##### (1)

- $\textcircled{\scriptsize 1}$

  ページ 6 $\sim$ ページ 7 にかけて「 $\sim$ 使用したポイントは、即座に使用可能ポイントから差し引かれる。」と書かれている。
  また、ページ 8 $>$ (2) $>$ $\textcircled{\scriptsize 4}$に　
  「ポイント統合は申請の翌日以降に有効となり、店舗販売と OL 販売のどちらでもポイントを使用できるようにする。」と書かれている。
  さらに、ページ 11 $\sim$ ページ 12 にかけて「 $\sim$ 店舗販売システムと OL 販売システムの間で直接データ交換を行うのではなく、連携システムに、両システムのデータを一部を統合、
  一部を複製した上で、連携システムを介して双方の情報連携を行う。」と書かれているので、ポイント統合が行われている場合、
  店舗販売システムでポイントが使用された場合は OL 販売システムの使用可能ポイントが同期されていないと不正にポイントが使用される場合があるので、

  `ポイント統合後の会員が購入時にポイントを使用した場合`

  となる。

- $\textcircled{\scriptsize 2}$

  ロールバックを行う必要があるのでデータを追加・更新・削除を行なっていた場合なので、会員テーブルを追加・参照・削除行なっている

  `会員登録, POS入力, ポイント反映`

  となる。

##### (2)

![午後2 設問1 表5](/img/png/Database/database-specialist/H29/2-1-chart-5.png "午後2 設問1 表5")

- a

  ページ 8 $>$ (1) $>$ $\textcircled{\scriptsize 1}$に
  「店舗販売業務と OL 販売業務を統括する販売統括部を新設し、両業務に共通する商品情報及びそれに関連する商品分類情報を管理する。」と記載されており、
  店舗販売システムと OL 販売システムでは情報を共有していないが、情報共有対象のテーブルに小分類コードが存在するので情報共有テーブルから参照されるので
  (ⅱ), (ⅲ)の連携 AP となるので

  配置方法$\textcircled{\scriptsize 2}$

  となる。

- b

  a と同じで分類コードは情報共有対象テーブルから参照されているかつ、販売統括部の管理下なので、

  配置方法$\textcircled{\scriptsize 2}$

  となる。

- c

  店舗販売システムでしか使用しないテーブルで情報共有対象テーブルからも参照されていないので、
  (ⅰ), (ⅱ)ともに満たさないから

  配置方法$\textcircled{\scriptsize 1}$

  となる。

- d

  店舗販売システムと OL 販売システムともに倉庫在庫テーブルが存在し、CRUD をみると参照・追加・更新が行われているので(ⅰ)を満たす。
  (ⅲ)は現行システムで追加・更新が行われるので、現行 AP となる。
  また、ページ 9 $>$ (3) $>$ $\textcircled{\scriptsize 1}$に
  「全エリアの倉庫からの配送を可能にして、店舗販売業務の取扱商品の多くを OL 販売で取り扱えるようにする」、
  $\textcircled{\scriptsize 2}$に
  「エリアの倉庫在庫から他エリアの店舗へ出荷できるようにする。」とあるので、両システムで同期をとる必要があることが分かるので、(ⅳ)では同期が必要となる。
  店舗販売システムでは倉庫コードと商品コードが主キーとなっているが、OL 販売システムでは商品コードのみが主キーとなっているので、
  商品コードが同じで倉庫コードが違うという更新があった場合に主キーが等しい行に対する更新が同時に発生するので、

  配置方法$\textcircled{\scriptsize 5}$

  となる。

- e

  店舗販売システムでしか使用しないテーブルで情報共有対象テーブルからも参照されていないので、

  (ⅰ), (ⅱ)ともに満たさないから

  配置方法$\textcircled{\scriptsize 1}$

  となる。

#### 設問 2

##### (1)

![午後2 設問1 図3](/img/png/Database/database-specialist/H29/2-1-figure-3.png "午後2 設問1 図3")

ページ 8 $>$ (2) $>$ $\textcircled{\scriptsize 2}$に
「会員から申請があれば、ポイント統合を行う。統合後は、OL 販売の会員番号を正規の会員番号とし、ポイントを集約する。」とあるので、
集約先の会員番号をもつ必要があることが分かる。

ページ 8 $>$ (2) $>$ $\textcircled{\scriptsize 3}$に
「会員は、統合するポイントカードの店舗コードと店舗会員番号を指定する。複数のポイントカードのうち、1 枚だけを存続させ、その他は廃止する。」とあるので、
廃止された会員番号かどうかを判断する必要があるので`廃止区分`属性が必要であることが分かる。

ページ 8 $>$ (2) $>$ $\textcircled{\scriptsize 4}$に
「 $\sim$ ポイント統合の対象となったポイントカードの統合申請日、統合対象ポイント(統合時点の使用可能ポイント)を記録し、 $\sim$ 」とあるので、
ポイントカードの統合申請日と統合対象ポイントを持つ必要があることが分かる。

まとめると、

| 列名             | 列値の内容                         |
| ---------------- | ---------------------------------- |
| 廃止区分         | ポイントカードの廃止有無を表す値   |
| 統合先会員番号   | ポイント統合後の統合先の会員番号   |
| 統合申請日       | ポイント統合の申請日               |
| 統合対象ポイント | ポイント統合時点の使用可能ポイント |

となる。

制約については、統合区分が統合済みである場合は既に統合されているはずなので統合先会員番号は NULL ではないということが分かる。
また、統合されるのは会員区分が店舗会員だけであるので、

`会員区分が店舗会員かつ統合区分が統合済みの場合、統合先会員番号はNULLでない`

となる。

##### (2)

![午後2 設問1 図4](/img/png/Database/database-specialist/H29/2-1-figure-4.png "午後2 設問1 図4")
![午後2 設問1 図5](/img/png/Database/database-specialist/H29/2-1-figure-5.png "午後2 設問1 図5")

- 権限の付与先

  ページ 15 $>$ 2. 会員の個人情報漏えい防止対策 $>$ $\textcircled{\scriptsize 1}$, $\textcircled{\scriptsize 2}$に　
  「会員番号、氏名、ポイントは全従業員に全会員の情報参照を許す。それ以外の情報(以下、機密情報という)の参照は、必要とする特定の役職及び特定の担当職務の従業員に限定する。」,
  「機密情報の参照が認められた従業員であっても、参照できるのは従業員が所属する店舗の登録会員の情報だけに限定する。」とある。
  また、ページ 12 $>$ 1, 権限 $>$ (3)に「テーブル、ビューのアクセス権限は、ユーザ ID, ロールに付与される。ロールは、ユーザ ID 及び他のロールに付与される。」とあるので
  会員ビュー V1 は会員番号, 氏名, ポイントを取得していることから

  `全従業員のユーザID`

  となる。

  会員ビュー V2 は機密情報となり、ページ 16 $>$ (2) $>$ $\textcircled{\scriptsize 4}$に
  「 $\sim$ 機密情報へのアクセス制御には、認可役職ロール、認可担当職務ロールを用いる。」とあるので、

  `認可役職ロール及び認可担当職務ロール`

  となる。

- g

  ページ 16 $>$ (2) $>$ $\textcircled{\scriptsize 5}$に
  「図 5 の SQL 文で作成したビューでは、従業員が所属する店舗の会員情報だけにアクセスを限定する。ただし、ポイント統合後の店舗会員については、統合先の OL 会員情報も参照可能とする。」とあるので、
  所属する店舗の会員情報と統合先の会員情報の 2 種類を SQL 文を考える必要があることがわかり、図 5 には UNION 句で 2 つの SQL を合わせている。
  初めの SELECT 文の方がシンプルに記述されているので所属する店舗の会員情報の部分であることが分かる。

  接続した従業員の情報が必要になるので

  `従業員`

  となる。

- h

  接続に用いられたユーザ ID は`CURRENT_USER`で分かるので、CURRENT_USER と従業員テーブルの従業員 ID を突き合わせることで特定の従業員の情報を取得することが可能であり、
  従業員テーブルには所属する店舗の情報が記載されているので、

  ```sql
  SELECT A.* FROM 会員 A INNER JOIN 従業員 B ON A.店舗コード = B.店舗コード AND B.従業員ID = CURRENT_USER
  ```

  となることから

  `A.店舗コード = B.店舗コード AND B.従業員ID = CURRENT_USER`

  となる

- i

  会員と会員とで内部結合しているので、統合先の会員情報を取得するために結合していると分かるので、

  `A.会員番号 = B.統合先会員番号`

  となる。

- j

  h と同じで同じ店舗の情報を見ることができるようにするので、

  `C.店舗コード = B.店舗コード AND C.従業員 = CURRENT_USER`

  となる。

  ※A.店舗コード ではなく B.店舗コードとなるのは、所属している店舗会員の統合先の会員情報を参照可能であるからである。

##### (3)

- 日締処理で行う操作

  ページ 16 $>$ 3. 販売分析データの作成(バッチ処理)に
  「 $\sim$ 店舗販売業務、OL 販売業務では、それぞれ、その日のうちに日締めを行なっているが、日締時刻は日によって異なり、順序も決まっていない。 $\sim$ 」
  とあるので、どちらが先に実行されても問題ないような処理が行われていることがわかる。
  また、ページ 17 の図 6 を見ると、

  ![午後2 設問1 図6](/img/png/Database/database-specialist/H29/2-1-figure-6.png "午後2 設問1 図6")

  主キーに処理年月日となっているのでデータの挿入 1 度しか行われないことも分かる。さらに、テーブルが存在している場合はもう一方の日締処理は行われていることが分かる。

  これらをまとめて考えると

  `行がなければ対応するフラグを完了、他方を未完了として行を追加し、行があれば対応するフラグを完了にして更新する`

  となる。

- トリガの定義内容

  トリガで行われる内容は ページ 16 $>$ 3. 販売分析データの作成(バッチ処理)に
  「 $\sim$ バッチ処理中の元データ更新を避けるため、両業務とも日締めが完了したときに、該当テーブルのレプリケーションを自動的に無効化する。 $\sim$ 」
  と書かれている。

  - $\textcircled{\scriptsize 1}$

    ページ 12 $>$ 2. トリガに「テーブルに対する操作(追加・更新)を契機に、あらかじめ定義された処理を実行する。実行タイミング(追加・更新の前又は後)、列値による実行条件を定義することができる。」
    とあるので、

    `更新`

    となる。

  - $\textcircled{\scriptsize 2}$

    実行条件は上記に書かれているとおりに

    `店舗日締フラグとOL日締フラグが共に完了であること`

    となる。

  - $\textcircled{\scriptsize 3}$

    行われる処理も上記に書かれているとおりに

    `レプリケーションを無効化する`

    となる。

#### 設問 3

##### (1)

![午後2 設問1 表1](/img/png/Database/database-specialist/H29/2-1-chart-1.png "午後2 設問1 表1")

- 追加するテーブル

- k
