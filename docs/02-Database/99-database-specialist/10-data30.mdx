---
title: 平成30年
sidebar_label: 平成30年
draft: true
toc_max_heading_level: 5
tags: [データベース, 資格, データベーススペシャリスト, 午後1, 午後2]
---

```mdx-code-block
import UnderLine from "@site/src/components/Custom/UnderLine"
import FontColor from "@site/src/components/Custom/FontColor"

```

以下の写真は全て実際の問題よりスクリーンショットで取得したものを表示させています。

## 午後 1

出典 : 平成 30 年度 春期 データベーススペシャリスト試験　午後 1

[問題](https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2018h30_1/2018h30h_db_pm1_qs.pdf)

[解答](https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2018h30_1/2018h30h_db_pm1_ans.pdf)

問題と解答は上記からダウンロードすることができます。

## 午後 2

出典 : 平成 30 年度 春期 データベーススペシャリスト試験　午後 2

[問題](https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2018h30_1/2018h30h_db_pm2_qs.pdf)

[解答](https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2018h30_1/2018h30h_db_pm2_ans.pdf)

問題と解答は上記からダウンロードすることができます。

### 大問 1

#### 設問 1

##### (1)

- 図 1 にある `ア`, `イ`に入る列名を答える問題

![午後2 設問1 図1](/img/png/Database/database-specialist/H30/2-figure-1.png "午後2 設問1 図1")

問題の 7 ページ目に`仮払い金精算`について書かれている。

![午後2 ページ7 (3)](/img/png/Database/database-specialist/H30/2-1-1-1.png "午後2 ページ7 (3)")

こちらを見ると、

「申請には`社員番号, 申請理由, 仮払金額, 精算期限`を記載し、未精算の仮払金は`仮払金残高`として記録する」と書かれている。
ここから、仮払金申請には最低でも`社員番号, 申請理由, 仮払金額, 精算期限, 仮払金残高`が記録されていることがわかる。

④ には仮払金精算について書かれており、「`一つの仮払いに対する精算が複数の日に分かれる`ことがある」から

{仮払金申請} $\rightarrow$ {仮払金精算}

であることが分かる。

また、「精算時には、`精算日ごと`に`精算金額を記録`し、」から仮払金精算には`精算金額`が保持されていることがわかる。
さらに、`精算日ごとに`とあり、`申請番号`と`精算日`が分かれば、仮払金精算が一意に定まることがわかる。

ここまでをまとめると

|                |                                                                                          |
| :------------: | :--------------------------------------------------------------------------------------: |
| ア(仮払金申請) |                              仮払金額, 精算期限, 仮払金残高                              |
| イ(仮払金精算) | <UnderLine px="2" >申請番号</UnderLine>, <UnderLine px="2" >精算日</UnderLine>, 精算金額 |

申請についてはさらに、7 ページ目の`3. 申請・精算の流れ`で説明されている。

![午後2 ページ7 3](/img/png/Database/database-specialist/H30/2-1-1-2.png "午後2 ページ7 3")
![午後2 ページ8 続き](/img/png/Database/database-specialist/H30/2-1-1-3.png "午後2 ページ8 続き")

このページの(2)の $\textcircled{\scriptsize 1}$ に「申請に`上司承認日`を記録して庶務担当者に回付する。」とあり、$\textcircled{\scriptsize 2}$ では「問題がなければ、申請に`精算日`を記録する」とある。
ここから、仮払金申請には`上司承認日, 精算日`の情報が存在していることがわかる。

$\textcircled{\scriptsize 2}$ ではさらに、「仮払金の申請は事務センタに回付する」とあり、事務センタでも何らかのデータを記録する可能性があることが分かる。
(3)の $\textcircled{\scriptsize 3}$ では「仮払金は、申請を基に一定額の支払を行い、申請に`支払実行日`を記録する」と記載されていることから
仮払金申請には`支払実行日`の情報が存在していることがわかる。

仮払金申請・仮払金精算について書かれているのは以上なので、これらを全てまとめると以下のようになる。

|                |                                                                                          |
| :------------: | :--------------------------------------------------------------------------------------: |
| ア(仮払金申請) |              仮払金額, 精算期限, 仮払金残高, 上司承認日, 精算日, 支払実行日              |
| イ(仮払金精算) | <UnderLine px="2" >申請番号</UnderLine>, <UnderLine px="2" >精算日</UnderLine>, 精算金額 |

##### (2)

- 表 6 の太枠を埋める問題

![午後2 表6](/img/png/Database/database-specialist/H30/2-chart-6.png "午後2 表6")

この表を埋める上で必要な情報は以下の表 1, 表 5 が必要です。

表 5 では型の説明であったり、バイトサイズについて記載され、
表 1 ではどんな情報(value)が入るのかが記載されている。

![午後2 表5](/img/png/Database/database-specialist/H30/2-chart-5.png "午後2 表5")

![午後2 表1](/img/png/Database/database-specialist/H30/2-chart-1.png "午後2 表1")

また、ページ 12-13 には設定する型の決定基準が記載されている。(長いのでスクショは省略)

各`データ型, NOT NULL, 格納長`を考えてから`索引の種類と構成列`について考えていく。

ページ 13 $>$ 1. テーブル定義 $>$ (1) $>$ $\textcircled{\scriptsize 3}$ にある
「$\textcircled{\scriptsize 1}$ 及び $\textcircled{\scriptsize 2}$ どちらの場合も、列の値の取り得る範囲に従って、格納領域の長さが最小になるデータ型を選択する」を前提に考えていく。

- 外貨金額

  データ型は「0.01 ~ 9,999,999,999.99 を指定」であることと ページ 13 $>$ 1. テーブル定義 $>$ (1) $>$ $\textcircled{\scriptsize 2}$ に
  「数値の列が整数である場合は、取り得る値の範囲に応じて、SMALLINT 又は INTEGER を選択する。それ以外の場合は DECIMAL を選択する。」
  と記載されていることから、`DECIMAL型`となる。精度は最大で 12 桁となるので`m = 12`であり、位取りは少数下２桁であることから
  `n = 2`である。

  NOT NULL は「申請登録時の指定は任意である」と記載されているので`No`となる。

  格納長は DECIMAL 型は「m $\div$ 2 + 1 の少数部を切り捨てバイト数の領域を格納される」であるので、`12 / 2 + 1 = 7`となる。
  しかし、ページ 12 $>$ 2. テーブル $>$ (1) に「NOT NULL 制約を指定しない列には、NULL か否かを表す 1 バイトのフラグを付加される。」
  とあるので、`7 + 1 = 8`となり、`8`バイトとなる。

- 支払い先

  データ型は「全角文字 100 字以内、平均文字数は 20 文字」であることとページ 13 $>$ 1. テーブル定義 $>$ (1) $>$ $\textcircled{\scriptsize 1}$ に
  「文字列型の列が全角文字の場合は、NCHAR 又は NCHAR VARYING を選択し、それ以外の場合は CHAR 又は CHAE VARCHAR を選択する。」
  と記載されていることから、`NCHAR VARYING型`となる。最大文字数は`100`と明記されているので、`NCHAR VARYING(100)`となる。

  NOT NULL は「申請登録時の指定は経費支払依頼では必須、立替経費精算では任意である。」と記載されているので`Yes`にしてしまうと、
  立替経費精算時にも必要になってしまい、問題文と矛盾が生じてしまう。従って`No`となる。

  格納長は「値の文字数 $\times$ 2 バイトの領域に格納され、4 バイトの制御情報が付加される」であることと
  ページ 13 $>$ 1. テーブル定義 $>$ (3) にある「可変長文字列の格納長は、表 1 から平均文字数が分かる場合はそれを基準に算出し、それ以外の場合は最大文字数の半分を基準に算出する。」
  と記載されていることから、`20 * 2 + 4 = 44`となり、さらに NOT NULL が`No`なので`44 + 1 = 45`となる。

- 支払目的

  データ型は「全角文字 1000 字以内、平均文字数は 64 文字」であることとページ 13 $>$ 1. テーブル定義 $>$ (1) $>$ $\textcircled{\scriptsize 1}$ より
  `NCHAR VARYING型`となる。最大文字数は`1000`と明記されているので、`NCHAR VARYING(1000)`となる。

  NOT NULL は「申請登録時の指定は必須である。」と記載されているので`Yes`となる。

  格納長は`64 * 2 + 4 = 132`バイトとなる。

- 支払予定日

  データ型は「支払の基になった支払伝票の支払予定日に記録する。」であることとページ 13 $>$ 1. テーブル定義 $>$ (1) $>$ ④ に
  「日付の列は、DATE を選択する。」と記載されていることから、`DATE型`となる。

  NOT NULL は「支払完了時に、支払の基になった支払伝票の支払予定日に記録する。」と記載されているので`No`となる。

  格納長は、「0001-01-01 ~ 9999-12-31 の範囲内の日付。4 バイトの領域に格納される。」と記載されていることから、`4`となり、さらに NOT NULL が`No`なので`4 + 1 = 5`となる。

- 支払番号

  データ型は「支払の基になった支払伝票の支払番号(1~99,999)を記録する。」であることとページ 13 $>$ 1. テーブル定義 $>$ (1) $>$ $\textcircled{\scriptsize 2}$ より`INTEGER型`となる。

  NOT NULL は「支払完了時に、支払の基になった支払伝票の支払番号(1~99,999)を記録する。」と記載されているので`No`となる。

  格納長は「-2,147,483,648 ~ 2,147,483,647 の範囲内の整数。4 バイトの領域に格納される。」と記載されていることから、`4`となり、さらに NOT NULL が`No`なので`4 + 1 = 5`となる。

ここまでをまとめると以下になる。

|    列名    |     　データ型      | NOT NULL | 格納長(バイト) |
| :--------: | :-----------------: | :------: | :------------: |
|  外貨金額  |    DECIMAL(12,2)    |    N     |       8        |
|   支払先   | NCHAR VARYING(100)  |    N     |       45       |
|  支払目的  | NCHAR VARYING(1000) |    Y     |      132       |
| 支払予定日 |        DATE         |    N     |       5        |
|  支払番号  |       INTEGER       |    N     |       5        |

次に索引について考える。これはページ 13 $>$ 1. テーブル定義 $>$ (4)に記載されている。
ここに書かれてる内容をまとめると

- P(主キーの索引) : 主キー
- U(ユニーク索引) : 主キー以外で値が一意となる列又は列の組み合わせ
- NU(非ユニーク索引) : P, U 以外の列又は列の組み合わせで外部キー

となる。これらより、`外貨金額, 支払先, 支払目的`は非キーであるため、索引を何もつけない。
しかし、`支払予定日, 支払番号`は外部キーとなっているため、U, NU の索引をつけることになる。

ページ 8 $>$ (3) $>$ $\textcircled{\scriptsize 2}$ に「一般経費は、`申請ごと`に支払伝票を作成し、`申請に支払伝票の支払予定日及び支払番号を記録`する。」と記載さており、
申請ごとに一意の`支払予定日, 支払番号`が記録されていることが分かる。そのため、`支払予定日, 支払番号`は`U`となり、最終的な解答は以下のようになる

|    列名    |     　データ型      | NOT NULL | 格納長(バイト) | 索引の種類と構成列 |
| :--------: | :-----------------: | :------: | :------------: | :----------------: |
|  外貨金額  |    DECIMAL(12,2)    |    N     |       8        |                    |
|   支払先   | NCHAR VARYING(100)  |    N     |       45       |                    |
|  支払目的  | NCHAR VARYING(1000) |    Y     |      132       |                    |
| 支払予定日 |        DATE         |    N     |       5        |        U(1)        |
|  支払番号  |       INTEGER       |    N     |       5        |        U(2)        |

##### (3)

- 検査制約を求める問題

(2)の支払い先は「申請登録時の指定は経費支払依頼では必須、立替経費精算では任意である。」であり、必須にすると任意に対応できないため、NOT NULL 制約を No としていた。
そのため、「経費支払依頼では必須」に対応するために検査制約をつける必要がある。

表 1 より申請種別より`経費支払依頼`か`立替経費精算`を判断することができ、検査制約は True となる条件を記述していく。

「立替経費精算では任意」より申請種別が立替経費精算であれば、特に何も検査する必要がないので、
`申請種別 = '1'`となる。

「経費支払依頼では必須」となっているので、`申請種別 = '2' AND 支払先 IS NOT NULL`となる。

この 2 つを合わせた`申請種別 = '1' OR 申請種別 = '2' AND 支払先 IS NOT NULL`が答えとなる。

##### (4)

- データ所要量を求める問題

![午後2 表7](/img/png/Database/database-specialist/H30/2-chart-7.png "午後2 表7")

- a

  これは表 2 にの一般経費申請のページサイズに`4000`と記載されているので、`4000`となる。

- b

  問題文に「空き領域率は 10 $\%$ とする」と記載されている。そのため。ページサイズを`4000 * 0.9 = 3600`バイトとして考える。
  項番 3 に平均行長 239 バイトと記載されているので、1 データページ(3600 バイト)当たりの平均行数は`3600 / 239 = 15.06`となり、`15`行が答えとなる。

- c

  必要なデータページ数は項番 1 の見積もり行数を平均行長で割ることで求めることができ、`1,500,000 / 15 = 100,000`となり、`100,000`ページとなる。

- d

  データ所要量は必要なデータページ数とページサイズを掛け合わせることで求めることができ、`100,000 * 4000 = 400,000,000`となり、`400`百万バイトとなる。

#### 設問 2

- DB サーバの性能見積もりの問題

![午後2 ページ15](/img/png/Database/database-specialist/H30/2-1-1-4.png "午後2 ページ15 ")

前提条件としてページ 15 $>$ 1. 性能見積もり にも記載されている通り、以下の問題では一般経費申請ついてのみを考えている。

- e

  ページ 15 $>$ 1. 性能見積もり $>$ (2) $>$ $\textcircled{\scriptsize 2}$, ④ に
  「CPU の 1 データページ当たりの処理時間は、0.2 ミリ秒である」と「トランザクションごとに、平均 50 データページにアクセスする」と記載されているので、
  CPU の 1 トランザクション当たりの処理時間は`50 * 0.2 = 10`ミリ秒となる。

- f

  200 トランザクションの処理時間は`10 * 200 = 2000`より、`2`秒となる。

- g (<FontColor color="red">間違っているかも</FontColor>)

  CPU1 つの場合は 200 トランザクションを処理するのに 2 秒必要であり、これでは、ページ 15 $>$ 1. 性能見積もり $>$ (1) $>$ $\textcircled{\scriptsize 2}$ にある
  「一般経費申請では 1 秒間に 200 トランザクションを処理することができる」とあるため、性能要件を満たしていない。

  200 トランザクション 2 秒で考えると難しくなるので、CPU1 つでは`100トランザクション 1秒`である。
  CPU を 2 つにした場合は`100 * 2 = 200`を 1 秒間に処理を行うことができ、性能要件を満たすが CPU 使用率は`100 / 100 = 1`となり、100$\%$となる。

  CPU を 3 つにした場合を考えてみると、`100 * 3 = 300`となり、性能要件を満たし、1CPU 当たり、66 トランザクションとなるので`66 /100 = 0.66`で 66$\%$となる。

  そのため、CPU を 3 つにすると性能要件を満たしつつ、CPU 使用率が 66$\%$となるので、`3`となる。

- h

  ページ 15 $>$ 1. 性能見積もり $>$ (2) $>$ $\textcircled{\scriptsize 3}$ に「1 データページ当たりのストレージへの I/O 時間は、20 ミリ秒である」とあり、バッファヒット率が 0$\%$なので、
  `20 * 50 = 1000`となり、`1`秒となる。

- i (<FontColor color="red">間違っているかも</FontColor>)

  バッファヒット率が 60$\%$なので、I/O 時間は`0.4 * 20 + 0.6 * 0 = 8`となり、1 データページ当たり`8`ミリ秒となる。
  CPU 処理時間と合わせると`0.2 + 8 = 8.2`ミリ秒であり、1 トランザクションでは`8.2 * 50 = 410`となり、`0.41`秒となる。

#### 設問 3

##### (1)

- サービス選定についての問題

![午後2 表8](/img/png/Database/database-specialist/H30/2-chart-8.png "午後2 表8")

- $\textcircled{\scriptsize 1}$

  経費システム全体の DB サーバに必要な CPU の個数を求めるにはページ 17 $>$ 1. サービスの選定 $>$ (2)に解答に必要な情報が乗っている。

  ページ 17 $>$ 1. サービスの選定 $>$ (2) $>$ $\textcircled{\scriptsize 1}$ とページ 15 $>$ 1. 性能見積もり $>$ (1) $>$ $\textcircled{\scriptsize 2}$ よりピーク時のトランザクション数は`400 + 200 = 600`となる。
  1CPU では 100 トランザクション 1 秒であるため、CPU を 6 個とすると、`600 / (100 * 6) = 1`となり、性能要件を満たすが CPU 使用率が 100$\%$となる。

  CPU 7 個の場合を考えると、`600 / (100 * 7) = 0.8571`となり、CPU 使用率は 85$\%$となるが、これも条件を満たしていない。

  CPU 8 個の場合を考えると、`600 / (100 * 8) = 0.75`となり、CPU 使用率は 75$\%$であるため、CPU は 8 個必要であることが分かる。

  ページ 17 $>$ 1. サービスの選定 $>$ (2) $>$ $\textcircled{\scriptsize 2}$, $\textcircled{\scriptsize 3}$ の情報と表 8 を見合わせて一番最適なものは`C4`となる。

- $\textcircled{\scriptsize 2}$

  ページ 17 $>$ 3. 専用サーバで提供されるサーバの障害対策 $>$ (1) $>$ $\textcircled{\scriptsize 3}$ に
  「データベースの更新ログは、5 分ごとにバックアップストレージに保存される。この場合のストレージは、データベースが使用するストレージとは別に用意される。」
  と記載されており、更新ログは 5 分おきにしかバックアップストレージに保存されない。
  つまり、バックアップストレージに保存した後の 5 分間の間に更新コミット $\rightarrow$ 障害発生の順に起きた場合は更新が反映されない。

##### (2)

- バッチ処理の性能についての問題

![午後2 表2](/img/png/Database/database-specialist/H30/2-chart-2.png "午後2 表2")

![午後2 表4](/img/png/Database/database-specialist/H30/2-chart-4.png "午後2 表4")

![午後2 表9](/img/png/Database/database-specialist/H30/2-chart-9.png "午後2 表9")

- $\textcircled{\scriptsize 1}$

  - j

    経費伝票作成は`旅費申請, 交通費申請, 一般経費申請, 寮費申請明細, 交通費申請明細`テーブルを使用しているので、
    `150,000 + 1,500,000 + 180,000 + 3,600,000 + 1,500,000 = 6,930,000`の見積もり行数であるが、検索するのは当月のみである。

    この見積もり行数はページ 8 $>$ 1. 現行システム $>$ (1) $>$ $\textcircled{\scriptsize 3}$ に
    「経費予算、申請に関する情報、及び申請から派生する伝票などの情報は、経費予算の年月又は申請の処理年月が 60 か月前から現在までのデータが全て保存されている。」
    と記載されているので、`6,930,000 / 60 = 115,500`となる。

  - k

    サーバ間通信対象行数は AP $\rightarrow$ DB と DB $\rightarrow$ AP との通信が存在する。
    ページ 17 $>$ 1. サービスの選定 $>$ (4) $\sim$ ページ 18 に「バッチ PGM は AP サーバで実行する」と記載されており、
    経費伝票作成はバッチ PGM で処理を行う旨が記載されているので、 DB $\rightarrow$ AP の通信が行われていることが分かる。

    また、処理結果を`経費伝票`テーブルに追加する旨も記載されているので、AP $\rightarrow$ DB の通信も行われていることが分かるので、
    `110,000 * 2 = 220,000`となる。

  - l

    経費分析表作成は`経費予算, 経費伝票`テーブルを使用しているので、`12,000 + 6,600,000 = 6,612,000`の見積もり行数である。
    「当月の 12 か月前から当月までの行を対象に処理を行う。」とあるので、`6,612,000 / 60 = 110,200`で 1 月当たりの行数を求め、これを 12(13)か月分にすると
    `110,200 * 12 = 1,322,400` or `110,200 * 13 = 1,432,600`となる。

  - m

    処理内容に「GROUP BY 句を用いて事業部、科目、年月ごとに集計して、$\dotsm$」とあり、
    ページ 6 $>$ 1. 組織、科目、経費予算、締日 $>$ (1) $>$ $\textcircled{\scriptsize 1}$と
    ページ 6 $>$ 1. 組織、科目、経費予算、締日 $>$ (2) $>$ $\textcircled{\scriptsize 1}$と
    に事業部が 10 であり、科目が 20 である旨が記述されている。

    そのため、`10 * 20 * 12 = 2400` or `10 * 20 * 13 = 2600`となる。

  - n

    経費分析表作成はファイル出力しかしないため、DB $\rightarrow$ AP の通信しか存在しない。
    そのため、`2400 * 1 = 2400` or `2600 * 1 = 2600`となる。

- $\textcircled{\scriptsize 2}$　(この問題は知識問題)

  - 処理名
    サーバ間通信対象行数を削減する上で一番効果的なのは、一番行数が多いものが第一候補となる。そのため、経費伝票作成処理が第一候補となる。

    これは AP $\leftrightarrow$ DB で双方向に通信を行っているので通信行数が多くなっている。
    双方向を通信が行われる原因はバッチ PGM を AP サーバで動作させる必要があるためであり、このバッチ PGM を DB サーバで行うことができれば、AP サーバとの通信が不必要となる。
    つまり、このバッチ PGM をストアドプロシージャに変更させることで AP サーバから実行命令だけを通信するだけでよくなる。

    そのため、`経費伝票作成`が変更すべき処理となる。

  - 対策内容

    上述のようにバッチ PGM の処理をストアドプロシージャに変更し、AP サーバから呼び出すだけでバッチ PGM 処理を行っていた場合と同じ結果を取得することが可能なので、
    `バッチPGMの処理をストアドプロシージャに変更し、APサーバから呼び出す`となる。

    :::info
    ストアドプロシージャの導入目的として、`処理の高速化`や`通信量の削減`などがある。
    :::

##### (3)

- スケジュールの設定に関する問題

ページ 8 $>$ 1. 現行システム $>$ (1) $>$ $\textcircled{\scriptsize 4}$に
「旅費交通費精算機能の運用時間帯は、平日の 8 時 $\sim$　 23 時であり、8 時 $\sim$ 20 時にオンライン処理、20 時 $\sim$ 23 時にバックアップ及びバッチ処理が行われる。」
とあるので、平日の 8 時 $\sim$　 23 時だけ起動させるだけ良いことが分かる。

そのため、データベースを平日の 8 時に起動して、23 時に停止する。
