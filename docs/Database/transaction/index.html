<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Database/transaction">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">トランザクション | 備忘録</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://koseki2580.github.io/study-docs/docs/Database/transaction"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="トランザクション | 備忘録"><meta data-rh="true" name="description" content="トランザクションとは"><meta data-rh="true" property="og:description" content="トランザクションとは"><link data-rh="true" rel="canonical" href="https://koseki2580.github.io/study-docs/docs/Database/transaction"><link data-rh="true" rel="alternate" href="https://koseki2580.github.io/study-docs/docs/Database/transaction" hreflang="ja"><link data-rh="true" rel="alternate" href="https://koseki2580.github.io/study-docs/docs/Database/transaction" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3TKZBSXW6M-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6FT13EFQVW"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6FT13EFQVW",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="備忘録" href="/study-docs/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="stylesheet" href="/study-docs/assets/css/styles.e5a947e5.css">
<link rel="preload" href="/study-docs/assets/js/runtime~main.23e46332.js" as="script">
<link rel="preload" href="/study-docs/assets/js/main.54645faa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/study-docs/"><b class="navbar__title text--truncate">勉強メモ</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">アルゴリズム</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/binary-search">2分探索</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/breadth-first-search">幅優先探索</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/depth-first-search">深さ優先探索</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/recursive">再帰処理</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/coordinate-compression">座標圧縮</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/doubling">ダブリング</a></li><li><a class="dropdown__link" href="/study-docs/docs/Algorithm/dijkstra">ダイクストラ法</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">データ構造</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/queue">キュー</a></li><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/stack">スタック</a></li><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/graph">グラフ</a></li><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/tree">木構造</a></li><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/priority-queue">優先度付きキュー</a></li><li><a class="dropdown__link" href="/study-docs/docs/Data-Structure/unionfind">Union-Find木</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">データベース</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Database/data-model/">データモデル</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Database/relational-data-model">関係モデル</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Database/normalization">正規化</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Database/transaction">トランザクション</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/study-docs/docs/Database/database-specialist/">データベーススペシャリスト</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ネットワーク</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/study-docs/docs/Network/sip">SIP</a></li><li><a class="dropdown__link" href="/study-docs/docs/Network/voip-network">VoIP</a></li><li><a class="dropdown__link" href="/study-docs/docs/Network/sdp">SDP</a></li><li><a class="dropdown__link" href="/study-docs/docs/Network/ip-packet">IP パケット</a></li><li><a class="dropdown__link" href="/study-docs/docs/Network/tunneling">トンネリング</a></li><li><a class="dropdown__link" href="/study-docs/docs/Network/diffie-hellman">Diffie-Hellman鍵交換方式</a></li><li><a class="dropdown__link" href="/study-docs/docs/Network/bgp4">BGP-4</a></li><li><a class="dropdown__link" href="/study-docs/docs/Network/was">WAN高速化装置</a></li><li><a class="dropdown__link" href="/study-docs/docs/Network/other">とりあえずまとめ</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">その他</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/study-docs/docs/other/certification">認証と認可</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/koseki2580/study-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="検索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">検索</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/study-docs/docs/Database/data-model/">データモデル</a><button aria-label="サイドバーのカテゴリー「データモデル」を開く・閉じる" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Database/relational-data-model">関係モデル</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/study-docs/docs/Database/normalization">正規化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/study-docs/docs/Database/transaction">トランザクション</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/study-docs/docs/Database/database-specialist/">データベーススペシャリスト</a><button aria-label="サイドバーのカテゴリー「データベーススペシャリスト」を開く・閉じる" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="サイドバーを隠す" aria-label="サイドバーを隠す" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/study-docs/">ホーム</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">トランザクション</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>トランザクション</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="トランザクションとは">トランザクションとは<a href="#トランザクションとは" class="hash-link" aria-label="トランザクションとは への直接リンク" title="トランザクションとは への直接リンク">​</a></h2><p>データベースが読み書き等の処理を複数まとめて一連の情報を処理することをいう。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="acid-特性">ACID 特性<a href="#acid-特性" class="hash-link" aria-label="ACID 特性 への直接リンク" title="ACID 特性 への直接リンク">​</a></h3><p>ACID 特性とはトランザクションが備えるべき 4 つの特性の頭文字を取ったものである。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="原子性-atomiicity">原子性 (Atomiicity)<a href="#原子性-atomiicity" class="hash-link" aria-label="原子性 (Atomiicity) への直接リンク" title="原子性 (Atomiicity) への直接リンク">​</a></h4><p>原子性は<code>トランザクションは「全て実行された」状態か「全く実行されていない」状態のどちらかの状態</code>である。
要するに途中で処理が中断されているものは存在しないということである。(ALL or Nothing)</p><p>原子性は全ての処理が完了した場合に COMMIT し、どこか一つでも失敗すると ROLL BACK を行うことで担保することができる。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="一貫性-consistency">一貫性 (Consistency)<a href="#一貫性-consistency" class="hash-link" aria-label="一貫性 (Consistency) への直接リンク" title="一貫性 (Consistency) への直接リンク">​</a></h4><p>一貫性は<code>トランザクションはデータベースの内容に矛盾を生じさせない</code>である。　
要するに実行前と実行後の結果に整合性があることが必要である。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="独立性-or-隔離性-isolation">独立性 or 隔離性 (Isolation)<a href="#独立性-or-隔離性-isolation" class="hash-link" aria-label="独立性 or 隔離性 (Isolation) への直接リンク" title="独立性 or 隔離性 (Isolation) への直接リンク">​</a></h4><p>独立性(隔離性)は<code>トランザクションは他のトランザクションの影響を受けない(与えない)</code>である。
独立性にはレベルがあり、他のトランザクションに影響を与える度合いを分離レベルと呼び、
<a href="#%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E5%88%86%E9%9B%A2%E3%83%AC%E3%83%99%E3%83%AB">トランザクション分離レベル</a>に詳細は記載している。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="耐久性-durability">耐久性 (Durability)<a href="#耐久性-durability" class="hash-link" aria-label="耐久性 (Durability) への直接リンク" title="耐久性 (Durability) への直接リンク">​</a></h4><p>耐久性は<code>正常に実行されたトランザクションの結果はその後障害が発生しても保持される</code>である。
要するに障害発生後に回復できるようにする必要がある。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="排他制御">排他制御<a href="#排他制御" class="hash-link" aria-label="排他制御 への直接リンク" title="排他制御 への直接リンク">​</a></h3><p>一貫性と独立性を担保するために複数のトランザクションが同時に実行された場合に制御する必要がある。
この時に、複数のトラザクションを実行した場合にトランザクションを完全に独立して順番に実行した結果と同じになることを
<code>直列可能性</code>といい、この性質を満たすように制御することを<code>同時実行制御</code>という。
この同時実行制御の方法としてロックを用いてデータベースの資源を制御する方法を<code>排他制御</code>という。(ロックされた資源を排他資源という)</p><p>ロックのかけ方には 2 種類存在する。</p><ul><li><p>共有ロック</p><p>データを参照する時だけにかけるロックであり、他のトランザクションからもデータを参照することができる。しかし、データの更新は行えない。</p></li><li><p>専有ロック</p><p>共有ロックとは異なり、他のトランザクションからデータの参照もできなくなる。他のトランザクションはロックが解放されるまで待機する。</p></li></ul><p>ロックの組み合わせは以下の表になる。</p><table><thead><tr><th align="center"></th><th align="center">共有ロック</th><th align="center">専有ロック</th></tr></thead><tbody><tr><td align="center">共有ロック</td><td align="center"><span style="color:red">共存可能</span></td><td align="center"><span style="color:blue">共存不可能</span></td></tr><tr><td align="center">専有ロック</td><td align="center"><span style="color:blue">共存不可能</span></td><td align="center"><span style="color:blue">共存不可能</span></td></tr></tbody></table><p>ロックには粒度が存在する。特定の行のみにロックをかけるのかテーブル全体にロックをかけるかといったものである。
対象の行のみロックすることを<code>行ロック</code>といい、テーブル全体をロックすることを<code>テーブルロック</code>という。</p><p>排他制御を行うことで一貫性と独立性を保つことが可能である。しかし、ロックをかけるタイミングによって<code>デッドロック</code>と呼ばれる状態に陥ることがある。</p><p>デッドロックとは 1 つのトランザクション内で 2 つ以上のデータにロックをかけるトランザクション処理が複数同時に発生した場合にお互いのトランザクションが
資源の解放待ちを行い、処理が停止してしまう現象をいう。</p><p><img loading="lazy" alt="デッドロック" src="/study-docs/assets/images/transaction-1.drawio-897998e14c4cdcb4495ee5a593d85cdb.svg" title="デッドロック" width="641" height="325" class="img_ev3q"></p><p>それぞれのトランザクションの初めの処理で A, B ともにテーブルがロックされている。
その後、トランザクション 1,2 ともに別のトランザクションがロックしているテーブルをロックしようと処理が行われると、テーブルはすでにロックされているので解放されるのを待つ。
しかし、お互いの次に必要な処理のテーブルがお互いによってロックされているのでこれ以上処理が進むことがない。</p><p>デッドロックを事前に検知する方法として待ちグラフが使用される。</p><p>待ちグラフとは実行中のトランザクションを各ノード、データのアンロック待ちの様子を矢印(有向辺)で表現したグラフである。
<a href="https://www.jitec.ipa.go.jp/1_04hanni_sukiru/mondai_kaitou_2017h29_2/2017h29a_ap_am_qs.pdf" target="_blank" rel="noopener noreferrer">平成 29 年 応用情報技術者試験 秋 午前</a> 29 問で
待ちグラフが出題されている。</p><p><img loading="lazy" alt="待ちグラフ" src="/study-docs/assets/images/H29-1-2-29-a9b83fd9a41bd730c06af4e4ae412e30.png" title="待ちグラフ" width="1082" height="742" class="img_ev3q"></p><p>排他制御の実現方法は複数存在するが、</p><ul><li>楽観的ロック</li><li>悲観的ロック</li></ul><p>の 2 つ実現方法が代表的である。それぞれの方法で開発コスト・競合を検知できるタイミング等が異なる。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="楽観的ロック">楽観的ロック<a href="#楽観的ロック" class="hash-link" aria-label="楽観的ロック への直接リンク" title="楽観的ロック への直接リンク">​</a></h3><p>楽観的(オプティミスティック)ロックはほとんど同時更新なんて起きないだろうという前提のもと考えられた実現方法である。</p><p>方法はデータを取得し、処理を行った後、処理開始時に取得した時とデータが同じ状態であったかを確認し、同じ状態であればデータを更新を行う。</p><p><img loading="lazy" alt="オプティミスティックロック" src="/study-docs/assets/images/transaction-2.drawio-a18470ef1229cbe93f34f11c312f625a.svg" title="オプティミスティックロック" width="641" height="462" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="悲観的ロック">悲観的ロック<a href="#悲観的ロック" class="hash-link" aria-label="悲観的ロック への直接リンク" title="悲観的ロック への直接リンク">​</a></h3><p>悲観的(ペシミスティック)ロックは楽観的ロックとは反対で、頻繁に同時更新が行われるという前提のもと考えられた実現方法である。</p><p>方法はデータを取得する際にデータをロックすることで他のトランザクションからのアクセスを防ぎ、データの更新を終了するとロックを解放する。</p><p>ただし、PC が強制的にダウンするなどの問題が生じた際にロックが解除されないといったことが生じる可能性がある。</p><p><img loading="lazy" alt="ペシミスティックロック" src="/study-docs/assets/images/transaction-3.drawio-8efe5f884178f30adc736ec0a6b955cd.svg" title="ペシミスティックロック" width="641" height="462" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="トランザクション分離レベル">トランザクション分離レベル<a href="#トランザクション分離レベル" class="hash-link" aria-label="トランザクション分離レベル への直接リンク" title="トランザクション分離レベル への直接リンク">​</a></h3><p>トランザクションの独立性を完全に満たすには同時実行数を 1 とし、1 度に 1 つのトランザクションしか動作させないようにするしかない。
しかし、1 度に 1 つのトランザクションしか動作しないのであれば、処理速度が遅くなってしまう。そのため、同時実行制御では、
独立性のレベル(分離レベル)をいくつか設定し、処理速度と独立性(データの整合性)を業務に合わせて設定できるようにしている。</p><p>トランザクション分離レベルには次の 4 つのレベルが設定されている。</p><ol><li><p>READ UNCOMMITTED (未コミット読み取り)</p><p>他のトランザクションのコミットされていないデータも読み取る。</p></li><li><p>READ COMMITTED (コミット読み取り)</p><p>他のトランザクションのコミットされているデータのみを読み取る。</p></li><li><p>REPEARABLE READ (反復読み取り)</p><p>トランザクションの実行中は読み取ったデータは何度読み込んでも必ず一致することを保証する。</p></li><li><p>SERIALIZABLE (直列化)</p><p>必ず直列可能性を満たすようにトランザクションを同時実行制御を行う。</p></li></ol><p>上から順に独立性が低く、処理速度が早くなっている。1 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em"></span><span class="mrel">∼</span></span></span></span></span> 3 のトランザクション分離レベル次のような問題が生じることがある。</p><ul><li>ダーティリード</li><li>ノンリピータブルリード</li><li>ファントムリード</li><li>(ロストアップデート)</li></ul><p>これらの問題が生じる分離レベルを表にすると以下のようになる。</p><table><thead><tr><th align="center"></th><th align="center">ダーティリード</th><th align="center">ノンリピータブルリード</th><th align="center">ファントムリード</th><th align="center">ロストアップデート</th></tr></thead><tbody><tr><td align="center">READ UNCOMMITTED</td><td align="center"><span style="color:red"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∙</mo></mrow><annotation encoding="application/x-tex">\bullet</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em"></span><span class="mord">∙</span></span></span></span></span></span></td><td align="center"><span style="color:red"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∙</mo></mrow><annotation encoding="application/x-tex">\bullet</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em"></span><span class="mord">∙</span></span></span></span></span></span></td><td align="center"><span style="color:red"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∙</mo></mrow><annotation encoding="application/x-tex">\bullet</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em"></span><span class="mord">∙</span></span></span></span></span></span></td><td align="center"><span style="color:green"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span></span></td></tr><tr><td align="center">READ COMMITTED</td><td align="center"><span style="color:green"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span></span></td><td align="center"><span style="color:red"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∙</mo></mrow><annotation encoding="application/x-tex">\bullet</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em"></span><span class="mord">∙</span></span></span></span></span></span></td><td align="center"><span style="color:red"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∙</mo></mrow><annotation encoding="application/x-tex">\bullet</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em"></span><span class="mord">∙</span></span></span></span></span></span></td><td align="center"><span style="color:green"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span></span></td></tr><tr><td align="center">REPEARABLE READ</td><td align="center"><span style="color:green"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span></span></td><td align="center"><span style="color:green"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span></span></td><td align="center"><span style="color:red"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∙</mo></mrow><annotation encoding="application/x-tex">\bullet</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em"></span><span class="mord">∙</span></span></span></span></span></span></td><td align="center"><span style="color:green"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span></span></td></tr><tr><td align="center">SERIALIZABLE</td><td align="center"><span style="color:green"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span></span></td><td align="center"><span style="color:green"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span></span></td><td align="center"><span style="color:green"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span></span></td><td align="center"><span style="color:green"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em"></span><span class="mord">×</span></span></span></span></span></span></td></tr></tbody></table><p>ロストアップデートは排他制御を行っている以上は生じない問題である。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ダーティリード">ダーティリード<a href="#ダーティリード" class="hash-link" aria-label="ダーティリード への直接リンク" title="ダーティリード への直接リンク">​</a></h4><p>変更途中のデータを読み取り、その変更途中のトランザクションがロールバックした場合に変更途中のデータを読み取ったトランザクションは誤ったデータを取得したことになる。
そのため、誤った情報がデータベースに記録されてしまうため、データ整合性が損なわれる問題。</p><p><img loading="lazy" alt="ダーティリード" src="/study-docs/assets/images/transaction-4.drawio-543ee77a1c9fed8d6fe3300383b80f3a.svg" title="ダーティリード" width="961" height="602" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ノンリピータブルリード">ノンリピータブルリード<a href="#ノンリピータブルリード" class="hash-link" aria-label="ノンリピータブルリード への直接リンク" title="ノンリピータブルリード への直接リンク">​</a></h4><p>コミット(確定)したデータのみを読み取るが、別トランザクションのコミット前ではコミット前のデータ、
コミット後はコミット後のデータを読み取る。
そのため、1 つのトランザクション内でデータを読み取るタイミング次第で値が変更してしまい、データ整合性が損なわれる問題。</p><p><img loading="lazy" alt="ノンリピータブルリード" src="/study-docs/assets/images/transaction-5.drawio-3cde504b5d27769ffcf78690e4936018.svg" title="ノンリピータブルリード" width="641" height="706" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ファントムリード">ファントムリード<a href="#ファントムリード" class="hash-link" aria-label="ファントムリード への直接リンク" title="ファントムリード への直接リンク">​</a></h4><p>トランザクション中にデータが新しく追加され、そのデータを扱うことでデータ整合性が損なわれる問題。</p><p><img loading="lazy" alt="ファントムリード" src="/study-docs/assets/images/transaction-6.drawio-a9ee9c30cdb8b84ba049090b0f34b96d.svg" title="ファントムリード" width="641" height="706" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ロストアップデート">ロストアップデート<a href="#ロストアップデート" class="hash-link" aria-label="ロストアップデート への直接リンク" title="ロストアップデート への直接リンク">​</a></h4><p>更新したデータが失われてしまい、データ整合性を損なわれる問題。</p><p><img loading="lazy" alt="ロストアップデート" src="/study-docs/assets/images/transaction-7.drawio-4de291245760a3fad59937dbaf8c248d.svg" title="ロストアップデート" width="741" height="462" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ログ">ログ<a href="#ログ" class="hash-link" aria-label="ログ への直接リンク" title="ログ への直接リンク">​</a></h3><p>ACID 属性の耐久性を保つために使用され、更新前ログと更新後ログの 2 種類が存在する。</p><p>CPU はメモリ上のデータしか操作ができない。そのため、データベースを利用する際はハードディスクからデータの読み込みが行われる。
データを更新してすぐにハードディスクデータが記録されるのではなく、<code>チェックポイント</code>と呼ばれる書き込みを行うポイントでハードディスクに書き込みを行う。
チェックポイントから次のチェックポイントの間に障害が発生した場合は、変更がハードディスクに記録されていないので、変更が失われてしまう。
そのため、ログにデータの変更を記録し、ログからデータを復元する。</p><p>ログも適度なタイミングでハードディスクに出力されるが、データとは異なり、コミットした瞬間にハードディスクにも記録する。</p><p>障害が発生した際の状況として以下の図のような 2 通りの状態が考えられる。</p><ol><li>トランザクション中にチェックポイントを迎え、次のチェックポイントの前に障害が発生 (図左)</li><li>トランザクションが完了し、コミットしたデータがチェックポイントを迎える前に障害が発生 (図右)</li></ol><p><img loading="lazy" alt="ログ" src="data:image/svg+xml;base64,PHN2ZyBob3N0PSI2NWJkNzExNDRlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI2MDFweCIgaGVpZ2h0PSIxNjFweCIgdmlld0JveD0iLTAuNSAtMC41IDYwMSAxNjEiIGNvbnRlbnQ9IiZsdDtteGZpbGUmZ3Q7Jmx0O2RpYWdyYW0gaWQ9JnF1b3Q7TXZ1UW84VUphd0dnNDNPYlV2dzEmcXVvdDsgbmFtZT0mcXVvdDvjg5rjg7zjgrgxJnF1b3Q7Jmd0OzdWbGRiOXNnRlAwMVBLNnl3Vjg4T21tNnZVeXFsSWR0ajlTUUdNMHhFU0ZOc2w4L2JJTWRmMlROSnJ0THQwcFJCQWU0d0QzbmNtOVRnT2FiNDBkSnR1bG5RVmtHb0VPUEFOMERDTVBJMWQ4RmNLb0F6d2tyWUMwNXJTQzNBWmI4QnpPZ1k5QTlwMnpYbXFpRXlCVGZ0c0ZFNURsTFZBc2pVb3BEZTlwS1pPMWR0MlROZXNBeUlWa2YvY0twU2lzMGdtR0RmMko4bmRxZDNRQlhJeHRpSjV1YjdGSkN4ZUVNUWd1QTVsSUlWYlUyeHpuTEN0OVp2MVRySGk2TTFnZVRMRmZYTFBEOWFzVXp5ZmJtY3VaZzZtUnZLOFUrcDZ4WTRBQTBPNlJjc2VXV0pNWG9RZE9yc1ZSdE10MXpkZE9ZWTFLeDQ4VXp1ZlZOdFVLWTJEQWxUM3FLV2VCRnhqbEdIVzVnK29mRzE5RE9TYy84YkRGaTZGM1hwaHNQNklaeHdyQkRFTDQ5aDlRTytCc084ZERMRG1FNWpZdXcwcjFjNUt6dEFIMUplZnBhT09zT3VwNEZ2bW5nZzNQbk9QV1UrNk54YU5VN25mY2VtZVQ2NUV3YWNNV3piQzR5SWN2OTBTcEtXSkpvZktlaytNN09ScDRpMy9QTEZTSlhTM05pUXdDanZTaC9rWkV6ai9zRERyZVlaQmxSL0xsdGZvZ0ZzOE9qNEhyakpnS2NOdUVhYUp2WWliMU1tRmwxSHQ0dkdLcVZZdzBwSXRkTTlReVZvcWl2ZloxT3JuaEozb0JPYmwwYXdWalM2QnFhVWhyQnV6UmVRUm9oSEVrYVhVTlRTbU1nM1M0UWlQVEhMUnNReEtGRmtFVWVESUx2TGVJWlpJYnM1S2duTVoyQVZWdFh2MGdYRjlSQk1yN09OWlpveWdzcHpZckV6blZsR0p1QkRhZTAySEN3TEdnWERpTlVCclYwTEZPd1h4a0VBNHBESXhRR2R1c0I2aUxUaUhHYkZnaG1RWnREalZoNmE1NW5xRWZkYjFWY1hlNVdMQmlPYkJyaUoyY2tKanpjWVNMc00rRTZBMVRBTWFpQXQvL0FVc0tpMVNBTlFSS3hwNVVlb1dTWGxpUzdwdk5JbExhWFZ5V2I0NzJCTnhpaGtkN2dycUVKMzJCL29NSmZZSUJqZ09kZzRZTjRVY1p2Q0RBR3M3aHNlQUEvL01uN1dsTjlTUnczOXI2aWJyWGx2K0w3NnQxK1VQOERWUk1NOFYwMFRzejJUVTFaT1VYdjZmZnNKNUpyMGkrY0t2MitnYjl2L28vMDYyTi9uRkR1R3BveS9ZYnY2ZmRDVlB0Qmg4N3AwcS91TnIrNlZ5dzIvN3BBaTU4PSZsdDsvZGlhZ3JhbSZndDsmbHQ7L214ZmlsZSZndDsiPgogICAgPGRlZnMvPgogICAgPGc+CiAgICAgICAgPHJlY3QgeD0iMzIwIiB5PSI0MCIgd2lkdGg9IjI4MCIgaGVpZ2h0PSI4MCIgZmlsbD0icmdiKDI1NSwgMjU1LCAyNTUpIiBzdHJva2U9InJnYigwLCAwLCAwKSIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxyZWN0IHg9IjAiIHk9IjQwIiB3aWR0aD0iMjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSJyZ2IoMjU1LCAyNTUsIDI1NSkiIHN0cm9rZT0icmdiKDAsIDAsIDApIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPHBhdGggZD0iTSAyNDAgMTIwIEwgMjQwIDQwIiBmaWxsPSJub25lIiBzdHJva2U9IiNiODU0NTAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgcG9pbnRlci1ldmVudHM9InN0cm9rZSIvPgogICAgICAgIDxwYXRoIGQ9Ik0gNDQwIDEyMCBMIDQ0MCA0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjYjg1NDUwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz4KICAgICAgICA8cGF0aCBkPSJNIDU2MCAxMjAgTCA1NjAgNDAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2I4NTQ1MCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+CiAgICAgICAgPHJlY3QgeD0iOTAiIHk9IjAiIHdpZHRoPSI2MCIgaGVpZ2h0PSIzMCIgZmlsbD0iI2Y4Y2VjYyIgc3Ryb2tlPSIjYjg1NDUwIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTVweDsgbWFyZ2luLWxlZnQ6IDkxcHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICIgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMnB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDjg4Hjgqfjg4Pjgq/jg53jgqTjg7Pjg4gKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICAgIDx0ZXh0IHg9IjEyMCIgeT0iMTkiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMnB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgICAgICAgICAgICAgICAgICDjg4Hjgqfjg4Pjgq/jg53jgqTjg7Pjg4gKICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxyZWN0IHg9IjMzMCIgeT0iNTAiIHdpZHRoPSIxMDAiIGhlaWdodD0iMjAiIGZpbGw9IiNmZmU2Y2MiIHN0cm9rZT0iI2Q3OWIwMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSkiPgogICAgICAgICAgICA8c3dpdGNoPgogICAgICAgICAgICAgICAgPGZvcmVpZ25PYmplY3QgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiA5OHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDYwcHg7IG1hcmdpbi1sZWZ0OiAzMzFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOODiOODqeODs+OCtuOCr+OCt+ODp+ODswogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iMzgwIiB5PSI2NCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIOODiOODqeODs+OCtuOCr+OCt+ODp+ODswogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHBhdGggZD0iTSAxNzAgMTIwIEwgMTcwIDQwIiBmaWxsPSJub25lIiBzdHJva2U9IiM2YzhlYmYiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLWRhc2hhcnJheT0iMSA0IiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+CiAgICAgICAgPHJlY3QgeD0iMTQwIiB5PSIxMzAiIHdpZHRoPSI2MCIgaGVpZ2h0PSIzMCIgZmlsbD0iI2RhZThmYyIgc3Ryb2tlPSIjNmM4ZWJmIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTQ1cHg7IG1hcmdpbi1sZWZ0OiAxNDFweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOmanOWus+eZuueUnwogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iMTcwIiB5PSIxNDkiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMnB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgICAgICAgICAgICAgICAgICDpmpzlrrPnmbrnlJ8KICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgICAgIDxwYXRoIGQ9Ik0gMTE5LjggMTIwIEwgMTE5LjggNDAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2I4NTQ1MCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+CiAgICAgICAgPHJlY3QgeD0iMzAiIHk9IjUwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZmZlNmNjIiBzdHJva2U9IiNkNzliMDAiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj4KICAgICAgICAgICAgPHN3aXRjaD4KICAgICAgICAgICAgICAgIDxmb3JlaWduT2JqZWN0IHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiIHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMTE4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogNjBweDsgbWFyZ2luLWxlZnQ6IDMxcHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7ICIgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC1zaXplOiAxMnB4OyBmb250LWZhbWlseTogSGVsdmV0aWNhOyBjb2xvcjogcmdiKDAsIDAsIDApOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyBvdmVyZmxvdy13cmFwOiBub3JtYWw7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDjg4jjg6njg7Pjgrbjgq/jgrfjg6fjg7MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9yZWlnbk9iamVjdD4KICAgICAgICAgICAgICAgIDx0ZXh0IHg9IjkwIiB5PSI2NCIgZmlsbD0icmdiKDAsIDAsIDApIiBmb250LWZhbWlseT0iSGVsdmV0aWNhIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAgICAgICAgICAgICAgICAgIOODiOODqeODs+OCtuOCr+OCt+ODp+ODswogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICA8L3N3aXRjaD4KICAgICAgICA8L2c+CiAgICAgICAgPHBhdGggZD0iTSA0MzUgMTIwIEwgNDM1IDQwIiBmaWxsPSJub25lIiBzdHJva2U9IiM2YzhlYmYiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLWRhc2hhcnJheT0iMSA0IiBwb2ludGVyLWV2ZW50cz0ic3Ryb2tlIi8+CiAgICAgICAgPHJlY3QgeD0iNDA1IiB5PSIxMzAiIHdpZHRoPSI2MCIgaGVpZ2h0PSIzMCIgZmlsbD0iI2RhZThmYyIgc3Ryb2tlPSIjNmM4ZWJmIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KSI+CiAgICAgICAgICAgIDxzd2l0Y2g+CiAgICAgICAgICAgICAgICA8Zm9yZWlnbk9iamVjdCBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5IiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDU4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogMTQ1cHg7IG1hcmdpbi1sZWZ0OiA0MDZweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtZHJhd2lvLWNvbG9ycz0iY29sb3I6IHJnYigwLCAwLCAwKTsgIiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDEycHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiByZ2IoMCwgMCwgMCk7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IG92ZXJmbG93LXdyYXA6IG5vcm1hbDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOmanOWus+eZuueUnwogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9mb3JlaWduT2JqZWN0PgogICAgICAgICAgICAgICAgPHRleHQgeD0iNDM1IiB5PSIxNDkiIGZpbGw9InJnYigwLCAwLCAwKSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxMnB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgICAgICAgICAgICAgICAgICDpmpzlrrPnmbrnlJ8KICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPC9zd2l0Y2g+CiAgICAgICAgPC9nPgogICAgPC9nPgogICAgPHN3aXRjaD4KICAgICAgICA8ZyByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiLz4KICAgICAgICA8YSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLC01KSIgeGxpbms6aHJlZj0iaHR0cHM6Ly93d3cuZGlhZ3JhbXMubmV0L2RvYy9mYXEvc3ZnLWV4cG9ydC10ZXh0LXByb2JsZW1zIiB0YXJnZXQ9Il9ibGFuayI+CiAgICAgICAgICAgIDx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtc2l6ZT0iMTBweCIgeD0iNTAlIiB5PSIxMDAlIj4KICAgICAgICAgICAgICAgIFZpZXdlciBkb2VzIG5vdCBzdXBwb3J0IGZ1bGwgU1ZHIDEuMQogICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgPC9hPgogICAgPC9zd2l0Y2g+Cjwvc3ZnPg==" title="ログ" width="601" height="161" class="img_ev3q"></p><p>1.は更新前ログを用いて<code>ロールバック(後退復帰)</code>を行い、トランザクションを実施する前の状態に戻し、データの整合性を保つ。</p><p>2.は更新後ログを用いて<code>ロールフォワード(前進復帰)</code>を行い、トランザクション実施後の状態に戻し、データの整合性を保つ。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="wal">WAL<a href="#wal" class="hash-link" aria-label="WAL への直接リンク" title="WAL への直接リンク">​</a></h4><p>ログの書き込みはメモリ上のデータの更新とともに行われる。そのため、更新時の書き込み処理として</p><ol><li>更新前ログの書き出し</li><li>実データの更新</li><li>更新後ログの書き出し</li></ol><p>の 3 つが存在する。この 3 つをどの順番で行うか特に定められていないが、1,2,3 の順に行うのが自然に見える。
しかし、2,3 の間で障害が発生した場合に 2 のデータは更新されたのどうかが分からなくなってしまう。
その問題を解決するために、1,3 のログ部分を先に書き出し、その後に 2 を行うようにすることでこのような問題が生じなくなる。</p><p>このように先にログを書き出す方法を WAL(Write Ahead Log)という。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a href="#参考" class="hash-link" aria-label="参考 への直接リンク" title="参考 への直接リンク">​</a></h2><ul><li><a href="https://qiita.com/NagaokaKenichi/items/73040df85b7bd4e9ecfc" target="_blank" rel="noopener noreferrer">https://qiita.com/NagaokaKenichi/items/73040df85b7bd4e9ecfc</a></li><li><a href="https://qiita.com/song_ss/items/38e514b05e9dabae3bdb" target="_blank" rel="noopener noreferrer">https://qiita.com/song_ss/items/38e514b05e9dabae3bdb</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>タグ:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/study-docs/docs/tags/db">DB</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/study-docs/docs/tags/トランザクション">トランザクション</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/koseki2580/study-docs/edit/main/docs/02-Database/03-transaction.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated"><b><time datetime="2023-03-11T04:55:40.000Z">2023年3月11日</time></b>に<b>koseki2580</b>が<!-- -->最終更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントのナビゲーション"><a class="pagination-nav__link pagination-nav__link--prev" href="/study-docs/docs/Database/normalization"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">正規化</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/study-docs/docs/Database/database-specialist/"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">初めに</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#トランザクションとは" class="table-of-contents__link toc-highlight">トランザクションとは</a><ul><li><a href="#acid-特性" class="table-of-contents__link toc-highlight">ACID 特性</a><ul><li><a href="#原子性-atomiicity" class="table-of-contents__link toc-highlight">原子性 (Atomiicity)</a></li><li><a href="#一貫性-consistency" class="table-of-contents__link toc-highlight">一貫性 (Consistency)</a></li><li><a href="#独立性-or-隔離性-isolation" class="table-of-contents__link toc-highlight">独立性 or 隔離性 (Isolation)</a></li><li><a href="#耐久性-durability" class="table-of-contents__link toc-highlight">耐久性 (Durability)</a></li></ul></li><li><a href="#排他制御" class="table-of-contents__link toc-highlight">排他制御</a></li><li><a href="#楽観的ロック" class="table-of-contents__link toc-highlight">楽観的ロック</a></li><li><a href="#悲観的ロック" class="table-of-contents__link toc-highlight">悲観的ロック</a></li><li><a href="#トランザクション分離レベル" class="table-of-contents__link toc-highlight">トランザクション分離レベル</a><ul><li><a href="#ダーティリード" class="table-of-contents__link toc-highlight">ダーティリード</a></li><li><a href="#ノンリピータブルリード" class="table-of-contents__link toc-highlight">ノンリピータブルリード</a></li><li><a href="#ファントムリード" class="table-of-contents__link toc-highlight">ファントムリード</a></li><li><a href="#ロストアップデート" class="table-of-contents__link toc-highlight">ロストアップデート</a></li></ul></li><li><a href="#ログ" class="table-of-contents__link toc-highlight">ログ</a><ul><li><a href="#wal" class="table-of-contents__link toc-highlight">WAL</a></li></ul></li></ul></li><li><a href="#参考" class="table-of-contents__link toc-highlight">参考</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/study-docs/assets/js/runtime~main.23e46332.js"></script>
<script src="/study-docs/assets/js/main.54645faa.js"></script>
</body>
</html>